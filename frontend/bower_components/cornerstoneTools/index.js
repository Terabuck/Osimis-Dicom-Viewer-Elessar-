/*! cornerstoneTools - v0.7.9 - 2016-07-13 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneTools */
"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof dicomParser&&(dicomParser={}),"undefined"==typeof cornerstoneTools&&(cornerstoneTools={referenceLines:{},orientation:{}}),function(e,o,t){"use strict";var n;function a(t){clearTimeout(n),n=setTimeout((function(){if(!("mousewheel"===t.originalEvent.type&&0===t.originalEvent.wheelDeltaY||"DOMMouseScroll"===t.originalEvent.type&&1===t.originalEvent.axis)){var n,a,r=t.currentTarget;void 0!==t.pageX&&void 0!==t.pageY?(n=t.pageX,a=t.pageY):t.originalEvent&&void 0!==t.originalEvent.pageX&&void 0!==t.originalEvent.pageY?(n=t.originalEvent.pageX,a=t.originalEvent.pageY):(n=t.x,a=t.y);var i=o.pageToPixel(r,n,a),s=(t=window.event||t).wheelDelta||-t.detail||-t.originalEvent.detail||-t.originalEvent.deltaY,l=Math.max(-1,Math.min(1,s)),c={element:r,viewport:o.getViewport(r),image:o.getEnabledElement(r).image,direction:l,pageX:n,pageY:a,imageX:i.x,imageY:i.y};e(r).trigger("CornerstoneToolsMouseWheel",c)}}),1)}function r(o){e(o).unbind("mousewheel DOMMouseScroll",a)}t.mouseWheelInput={enable:function(o){r(o),e(o).on("mousewheel DOMMouseScroll",a)},disable:r}}($,cornerstone,cornerstoneTools),function(e,o,t,n){"use strict";var a,r;function i(){a=!1}function s(a){var r=a.currentTarget,i="CornerstoneToolsMouseDoubleClick",s={page:t.point.pageToPoint(a),image:o.pageToPixel(r,a.pageX,a.pageY),client:{x:a.clientX,y:a.clientY}};s.canvas=o.pixelToCanvas(r,s.image);var l=n.copyPoints(s),c={event:a,which:a.which,viewport:o.getViewport(r),image:o.getEnabledElement(r).image,element:r,startPoints:s,lastPoints:l,currentPoints:s,deltaPoints:{x:0,y:0},type:i},u=e.Event(i,c);e(c.element).trigger(u,c)}function l(s){r=setTimeout(i,200);var l=s.currentTarget;e(l).off("mousemove",c);var u={page:t.point.pageToPoint(s),image:o.pageToPixel(l,s.pageX,s.pageY),client:{x:s.clientX,y:s.clientY}};u.canvas=o.pixelToCanvas(l,u.image);var d,g=n.copyPoints(u),f={event:s,which:s.which,viewport:o.getViewport(l),image:o.getEnabledElement(l).image,element:l,startPoints:u,lastPoints:g,currentPoints:u,deltaPoints:{x:0,y:0},type:"CornerstoneToolsMouseDown"},m=e.Event("CornerstoneToolsMouseDown",f);if(e(f.element).trigger(m,f),!1===m.isImmediatePropagationStopped()&&!0===void e((d=f).element).trigger("CornerstoneToolsMouseDownActivate",d))return n.pauseEvent(s);var h=s.which;function v(a){var r={page:t.point.pageToPoint(a),image:o.pageToPixel(l,a.pageX,a.pageY),client:{x:a.clientX,y:a.clientY}};r.canvas=o.pixelToCanvas(l,r.image);var i={page:t.point.subtract(r.page,g.page),image:t.point.subtract(r.image,g.image),client:t.point.subtract(r.client,g.client),canvas:t.point.subtract(r.canvas,g.canvas)},s={which:h,viewport:o.getViewport(l),image:o.getEnabledElement(l).image,element:l,startPoints:u,lastPoints:g,currentPoints:r,deltaPoints:i,type:"CornerstoneToolsMouseDrag"};return e(s.element).trigger("CornerstoneToolsMouseDrag",s),g=n.copyPoints(r),n.pauseEvent(a)}return e(document).on("mousemove",v),e(document).on("mouseup",(function n(i){clearTimeout(r);var s="CornerstoneToolsMouseUp";a&&(s="CornerstoneToolsMouseClick");var d={page:t.point.pageToPoint(i),image:o.pageToPixel(l,i.pageX,i.pageY),client:{x:i.clientX,y:i.clientY}};d.canvas=o.pixelToCanvas(l,d.image);var f={page:t.point.subtract(d.page,g.page),image:t.point.subtract(d.image,g.image),client:t.point.subtract(d.client,g.client),canvas:t.point.subtract(d.canvas,g.canvas)},m={event:i,which:h,viewport:o.getViewport(l),image:o.getEnabledElement(l).image,element:l,startPoints:u,lastPoints:g,currentPoints:d,deltaPoints:f,type:s},T=e.Event(s,m);e(m.element).trigger(T,m),e(document).off("mousemove",v),e(document).off("mouseup",n),e(m.element).on("mousemove",c),a=!0})),n.pauseEvent(s)}function c(a){var r=a.currentTarget,i={page:t.point.pageToPoint(a),image:o.pageToPixel(r,a.pageX,a.pageY),client:{x:a.clientX,y:a.clientY}};i.canvas=o.pixelToCanvas(r,i.image);var s=n.copyPoints(i),l=a.which,c={page:t.point.pageToPoint(a),image:o.pageToPixel(r,a.pageX,a.pageY),client:{x:a.clientX,y:a.clientY}};c.canvas=o.pixelToCanvas(r,c.image);var u={page:t.point.subtract(c.page,s.page),image:t.point.subtract(c.image,s.image),client:t.point.subtract(c.client,s.client),canvas:t.point.subtract(c.canvas,s.canvas)},d={which:l,viewport:o.getViewport(r),image:o.getEnabledElement(r).image,element:r,startPoints:i,lastPoints:s,currentPoints:c,deltaPoints:u,type:"CornerstoneToolsMouseMove"};e(r).trigger("CornerstoneToolsMouseMove",d),s=n.copyPoints(c)}function u(o){e(o).off("mousedown",l),e(o).off("mousemove",c),e(o).off("dblclick",s)}n.mouseInput={enable:function(o){u(o),e(o).on("mousedown",l),e(o).on("mousemove",c),e(o).on("dblclick",s)},disable:u}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t,n){"use strict";var a,r,i,s,l,c,u,d,g=1,f=0,m=!1,h=!1;function v(v){var T,p,C=v.target.parentNode;switch(v.preventDefault(),(v.pointers&&v.pointers.length>1||v.originalEvent&&v.originalEvent.touches&&v.originalEvent.touches.length>1)&&(m=!1,clearTimeout(u)),v.type){case"tap":m=!1,clearTimeout(u),(r={page:t.point.pageToPoint(v.pointers[0]),image:o.pageToPixel(C,v.pointers[0].pageX,v.pointers[0].pageY),client:{x:v.pointers[0].clientX,y:v.pointers[0].clientY}}).canvas=o.pixelToCanvas(C,r.image),p="CornerstoneToolsTap",l={event:v,viewport:o.getViewport(C),image:o.getEnabledElement(C).image,element:C,currentPoints:r,type:p,isTouchEvent:!0},T=e.Event(p,l),e(C).trigger(T,l);break;case"doubletap":m=!1,clearTimeout(u),(r={page:t.point.pageToPoint(v.pointers[0]),image:o.pageToPixel(C,v.pointers[0].pageX,v.pointers[0].pageY),client:{x:v.pointers[0].clientX,y:v.pointers[0].clientY}}).canvas=o.pixelToCanvas(C,r.image),p="CornerstoneToolsDoubleTap",l={event:v,viewport:o.getViewport(C),image:o.getEnabledElement(C).image,element:C,currentPoints:r,type:p,isTouchEvent:!0},T=e.Event(p,l),e(C).trigger(T,l);break;case"pinchstart":m=!1,clearTimeout(u),g=1;break;case"pinchmove":if(m=!1,clearTimeout(u),!0===h){g=v.scale,h=!1;break}var x=(v.scale-g)/g;(a={page:v.center,image:o.pageToPixel(C,v.center.x,v.center.y)}).canvas=o.pixelToCanvas(C,a.image),p="CornerstoneToolsTouchPinch",l={event:v,startPoints:a,viewport:o.getViewport(C),image:o.getEnabledElement(C).image,element:C,direction:v.scale<1?1:-1,scaleChange:x,type:p,isTouchEvent:!0},T=e.Event(p,l),e(C).trigger(T,l),g=v.scale;break;case"touchstart":g=1,clearTimeout(u),clearTimeout(c),c=setTimeout((function(){(a={page:t.point.pageToPoint(v.originalEvent.touches[0]),image:o.pageToPixel(C,v.originalEvent.touches[0].pageX,v.originalEvent.touches[0].pageY),client:{x:v.originalEvent.touches[0].clientX,y:v.originalEvent.touches[0].clientY}}).canvas=o.pixelToCanvas(C,a.image),p="CornerstoneToolsTouchStart",v.originalEvent.touches.length>1&&(p="CornerstoneToolsMultiTouchStart"),l={event:v,viewport:o.getViewport(C),image:o.getEnabledElement(C).image,element:C,startPoints:a,currentPoints:a,type:p,isTouchEvent:!0},T=e.Event(p,l),e(C).trigger(T,l),!1===T.isImmediatePropagationStopped()&&(p="CornerstoneToolsTouchStartActive",v.originalEvent.touches.length>1&&(p="CornerstoneToolsMultiTouchStartActive"),l.type=p,e(C).trigger(p,l)),i=n.copyPoints(a)}),50),m=!0,d=0,u=setTimeout((function(){m&&((r={page:t.point.pageToPoint(v.originalEvent.touches[0]),image:o.pageToPixel(C,v.originalEvent.touches[0].pageX,v.originalEvent.touches[0].pageY),client:{x:v.originalEvent.touches[0].clientX,y:v.originalEvent.touches[0].clientY}}).canvas=o.pixelToCanvas(C,a.image),p="CornerstoneToolsTouchPress",l={event:v,viewport:o.getViewport(C),image:o.getEnabledElement(C).image,element:C,currentPoints:r,type:p,isTouchEvent:!0},T=e.Event(p,l),e(C).trigger(T,l))}),700);break;case"touchend":g=1,m=!1,clearTimeout(u),setTimeout((function(){(a={page:t.point.pageToPoint(v.originalEvent.changedTouches[0]),image:o.pageToPixel(C,v.originalEvent.changedTouches[0].pageX,v.originalEvent.changedTouches[0].pageY),client:{x:v.originalEvent.changedTouches[0].clientX,y:v.originalEvent.changedTouches[0].clientY}}).canvas=o.pixelToCanvas(C,a.image),p="CornerstoneToolsTouchEnd",l={event:v,viewport:o.getViewport(C),image:o.getEnabledElement(C).image,element:C,startPoints:a,currentPoints:a,type:p,isTouchEvent:!0},T=e.Event(p,l),e(C).trigger(T,l)}),50);break;case"panmove":(r={page:t.point.pageToPoint(v.pointers[0]),image:o.pageToPixel(C,v.pointers[0].pageX,v.pointers[0].pageY),client:{x:v.pointers[0].clientX,y:v.pointers[0].clientY}}).canvas=o.pixelToCanvas(C,r.image),s={page:t.point.subtract(r.page,i.page),image:t.point.subtract(r.image,i.image),client:t.point.subtract(r.client,i.client),canvas:t.point.subtract(r.canvas,i.canvas)},(d+=Math.sqrt(s.page.x*s.page.x+s.page.y*s.page.y))>5&&(m=!1,clearTimeout(u)),p="CornerstoneToolsTouchDrag",v.pointers.length>1&&(p="CornerstoneToolsMultiTouchDrag"),l={viewport:o.getViewport(C),image:o.getEnabledElement(C).image,element:C,startPoints:a,lastPoints:i,currentPoints:r,deltaPoints:s,numPointers:v.pointers.length,type:p,isTouchEvent:!0},T=e.Event(p,l),e(C).trigger(T,l),i=n.copyPoints(r);break;case"panstart":(r={page:t.point.pageToPoint(v.pointers[0]),image:o.pageToPixel(C,v.pointers[0].pageX,v.pointers[0].pageY),client:{x:v.pointers[0].clientX,y:v.pointers[0].clientY}}).canvas=o.pixelToCanvas(C,r.image),i=n.copyPoints(r);break;case"panend":return m=!1,clearTimeout(u),i?((r={page:t.point.pageToPoint(v.pointers[0]),image:o.pageToPixel(C,v.pointers[0].pageX,v.pointers[0].pageY),client:{x:v.pointers[0].clientX,y:v.pointers[0].clientY}}).canvas=o.pixelToCanvas(C,r.image),s={page:t.point.subtract(r.page,i.page),image:t.point.subtract(r.image,i.image),client:t.point.subtract(r.client,i.client),canvas:t.point.subtract(r.canvas,i.canvas)},p="CornerstoneToolsDragEnd",l={event:v.srcEvent,viewport:o.getViewport(C),image:o.getEnabledElement(C).image,element:C,startPoints:a,lastPoints:i,currentPoints:r,deltaPoints:s,type:p,isTouchEvent:!0},T=e.Event(p,l),e(C).trigger(T,l),2===v.pointers.length-v.changedPointers.length&&(h=!0),n.pauseEvent(v)):!1;case"rotatemove":m=!1,clearTimeout(u);var M=v.rotation-f;f=v.rotation,p="CornerstoneToolsTouchRotate",l={event:v.srcEvent,viewport:o.getViewport(C),image:o.getEnabledElement(C).image,element:C,rotation:M,type:p},T=e.Event(p,l),e(C).trigger(T,l)}return!1}function T(o){n.preventGhostClick.disable(o),e(o).off("touchstart touchend",v);var t=e(o).data("hammer");t&&t.off("tap doubletap panstart panmove panend pinchmove rotatemove",v)}n.touchInput={enable:function(o){T(o);var t={inputClass:Hammer.SUPPORT_POINTER_EVENTS?Hammer.PointerEventInput:Hammer.TouchInput},a=new Hammer.Manager(o,t),r={pointers:0,direction:Hammer.DIRECTION_ALL,threshold:0},i=new Hammer.Pan(r),s=new Hammer.Pinch({threshold:0}),l=new Hammer.Rotate({threshold:0});s.recognizeWith(i),s.recognizeWith(l),l.recognizeWith(i);var c=new Hammer.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});c.recognizeWith(i),a.add([c,i,l,s]),a.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",v),n.preventGhostClick.enable(o),e(o).on("touchstart touchend",v),e(o).data("hammer",a)},disable:T}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t){"use strict";t.simpleMouseButtonTool=function(o){var t={};return{activate:function(t,n,a){e(t).off("CornerstoneToolsMouseDownActivate",o);var r={mouseButtonMask:n,options:a};e(t).on("CornerstoneToolsMouseDownActivate",r,o)},disable:function(t){e(t).off("CornerstoneToolsMouseDownActivate",o)},enable:function(t){e(t).off("CornerstoneToolsMouseDownActivate",o)},deactivate:function(t){e(t).off("CornerstoneToolsMouseDownActivate",o)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}}}($,cornerstone,cornerstoneTools),function(e,o,t,n){"use strict";n.mouseButtonTool=function(t){var a={};function r(a,l){if(n.isMouseButtonEnabled(l.which,a.data.mouseButtonMask))return t.addNewMeasurement?t.addNewMeasurement(l):function(a){var l=a.element,c=t.createNewMeasurement(a);if(c){var u,d,g={mouseButtonMask:a.which};n.addToolState(a.element,t.toolType,c),e(l).off("CornerstoneToolsMouseMove",t.mouseMoveCallback||i),e(l).off("CornerstoneToolsMouseDown",t.mouseDownCallback||s),e(l).off("CornerstoneToolsMouseDownActivate",t.mouseDownActivateCallback||r),t.mouseDoubleClickCallback&&e(l).off("CornerstoneToolsMouseDoubleClick",t.mouseDoubleClickCallback),o.updateImage(l),u=1===Object.keys(c.handles).length?n.moveHandle:n.moveNewHandle,d=!(!t.options||void 0===t.options.preventHandleOutsideImage)&&t.options.preventHandleOutsideImage,u(a,t.toolType,c,c.handles.end,(function(){c.active=!1,c.invalidated=!0,n.anyHandlesOutsideImage(a,c.handles)&&n.removeToolState(l,t.toolType,c),e(l).on("CornerstoneToolsMouseMove",g,t.mouseMoveCallback||i),e(l).on("CornerstoneToolsMouseDown",g,t.mouseDownCallback||s),e(l).on("CornerstoneToolsMouseDownActivate",g,t.mouseDownActivateCallback||r),t.mouseDoubleClickCallback&&e(l).on("CornerstoneToolsMouseDoubleClick",g,t.mouseDoubleClickCallback),o.updateImage(l)}),d)}}(l),!1}function i(e,a){if(n.toolCoordinates.setCoords(a),0===a.which){var r=n.getToolState(a.element,t.toolType);if(r){for(var i=!1,s=0;s<r.data.length;s++){var l=a.currentPoints.canvas,c=r.data[s];!0===n.handleActivator(a.element,c.handles,l)&&(i=!0),(t.pointNearTool(a.element,c,l)&&!c.active||!t.pointNearTool(a.element,c,l)&&c.active)&&(c.active=!c.active,i=!0)}!0===i&&o.updateImage(a.element)}}}function s(a,r){var s,l=r.element;function c(){s.invalidated=!0,n.anyHandlesOutsideImage(r,s.handles)&&n.removeToolState(l,t.toolType,s),o.updateImage(l),e(l).on("CornerstoneToolsMouseMove",r,t.mouseMoveCallback||i)}if(n.isMouseButtonEnabled(r.which,a.data.mouseButtonMask)){var u=r.startPoints.canvas,d=n.getToolState(a.currentTarget,t.toolType);if(d){var g,f;for(f=!(!t.options||void 0===t.options.preventHandleOutsideImage)&&t.options.preventHandleOutsideImage,g=0;g<d.data.length;g++){s=d.data[g];var m=n.getHandleNearImagePoint(l,s.handles,u,6);if(m)return e(l).off("CornerstoneToolsMouseMove",t.mouseMoveCallback||i),s.active=!0,n.moveHandle(r,t.toolType,s,m,c,f),a.stopImmediatePropagation(),!1}if(t.pointNearTool){var h=t.options||{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(g=0;g<d.data.length;g++)if((s=d.data[g]).active=!1,t.pointNearTool(l,s,u))return s.active=!0,e(l).off("CornerstoneToolsMouseMove",t.mouseMoveCallback||i),n.moveAllHandles(a,s,d,t.toolType,h,c),a.stopImmediatePropagation(),!1}}}}var l={enable:function(n){e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsMouseMove",t.mouseMoveCallback||i),e(n).off("CornerstoneToolsMouseDown",t.mouseDownCallback||s),e(n).off("CornerstoneToolsMouseDownActivate",t.mouseDownActivateCallback||r),t.mouseDoubleClickCallback&&e(n).off("CornerstoneToolsMouseDoubleClick",t.mouseDoubleClickCallback),e(n).on("CornerstoneImageRendered",t.onImageRendered),o.updateImage(n)},disable:function(n){e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsMouseMove",t.mouseMoveCallback||i),e(n).off("CornerstoneToolsMouseDown",t.mouseDownCallback||s),e(n).off("CornerstoneToolsMouseDownActivate",t.mouseDownActivateCallback||r),t.mouseDoubleClickCallback&&e(n).off("CornerstoneToolsMouseDoubleClick",t.mouseDoubleClickCallback),o.updateImage(n)},activate:function(n,a){var l={mouseButtonMask:a};e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsMouseMove",t.mouseMoveCallback||i),e(n).off("CornerstoneToolsMouseDown",t.mouseDownCallback||s),e(n).off("CornerstoneToolsMouseDownActivate",t.mouseDownActivateCallback||r),e(n).on("CornerstoneImageRendered",t.onImageRendered),e(n).on("CornerstoneToolsMouseMove",l,t.mouseMoveCallback||i),e(n).on("CornerstoneToolsMouseDown",l,t.mouseDownCallback||s),e(n).on("CornerstoneToolsMouseDownActivate",l,t.mouseDownActivateCallback||r),t.mouseDoubleClickCallback&&(e(n).off("CornerstoneToolsMouseDoubleClick",t.mouseDoubleClickCallback),e(n).on("CornerstoneToolsMouseDoubleClick",l,t.mouseDoubleClickCallback)),o.updateImage(n)},deactivate:function(n,a){var l={mouseButtonMask:a},c="CornerstoneToolsToolDeactivated",u={mouseButtonMask:a,toolType:t.toolType,type:c},d=e.Event(c,u);e(n).trigger(d,u),e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsMouseMove",t.mouseMoveCallback||i),e(n).off("CornerstoneToolsMouseDown",t.mouseDownCallback||s),e(n).off("CornerstoneToolsMouseDownActivate",t.mouseDownActivateCallback||r),e(n).on("CornerstoneImageRendered",t.onImageRendered),e(n).on("CornerstoneToolsMouseMove",l,t.mouseMoveCallback||i),e(n).on("CornerstoneToolsMouseDown",l,t.mouseDownCallback||s),t.mouseDoubleClickCallback&&(e(n).off("CornerstoneToolsMouseDoubleClick",t.mouseDoubleClickCallback),e(n).on("CornerstoneToolsMouseDoubleClick",l,t.mouseDoubleClickCallback)),o.updateImage(n)},getConfiguration:function(){return a},setConfiguration:function(e){a=e},mouseDownCallback:s,mouseMoveCallback:i,mouseDownActivateCallback:r};return t.pointNearTool&&(l.pointNearTool=t.pointNearTool),t.mouseDoubleClickCallback&&(l.mouseDoubleClickCallback=t.mouseDoubleClickCallback),t.addNewMeasurement&&(l.addNewMeasurement=t.addNewMeasurement),l}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t,n){"use strict";n.mouseButtonRectangleTool=function(t,a){function r(o,r){if(n.isMouseButtonEnabled(r.which,o.data.mouseButtonMask))return s=r,(l=t.createNewMeasurement(s))&&(n.addToolState(s.element,t.toolType,l),e(s.element).off("CornerstoneToolsMouseMove",i),n.moveHandle(s,t.toolType,l,l.handles.end,(function(){l.active=!1,n.anyHandlesOutsideImage(s,l.handles)&&n.removeToolState(s.element,t.toolType,l),e(s.element).on("CornerstoneToolsMouseMove",i)}),a)),!1;var s,l}function i(e,a){if(n.toolCoordinates.setCoords(a),0===a.which){var r=n.getToolState(a.element,t.toolType);if(void 0!==r){for(var i=!1,s=a.currentPoints.canvas,l=0;l<r.data.length;l++){var c=r.data[l];!0===n.handleActivator(a.element,c.handles,s)&&(i=!0),(t.pointInsideRect(a.element,c,s)&&!c.active||!t.pointInsideRect(a.element,c,s)&&c.active)&&(c.active=!c.active,i=!0)}!0===i&&o.updateImage(a.element)}}}function s(r,s){var l;function c(){l.active=!1,n.anyHandlesOutsideImage(s,l.handles)&&n.removeToolState(s.element,t.toolType,l),o.updateImage(s.element),e(s.element).on("CornerstoneToolsMouseMove",i)}if(n.isMouseButtonEnabled(s.which,r.data.mouseButtonMask)){var u,d=s.startPoints.canvas,g=n.getToolState(r.currentTarget,t.toolType);if(void 0!==g)for(u=0;u<g.data.length;u++){l=g.data[u];var f=n.getHandleNearImagePoint(s.element,l.handles,d,25);if(void 0!==f)return e(s.element).off("CornerstoneToolsMouseMove",i),l.active=!0,n.moveHandle(s,t.toolType,l,f,c,a),r.stopImmediatePropagation(),!1}var m={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:a};if(void 0!==g&&void 0!==t.pointInsideRect)for(u=0;u<g.data.length;u++)if(l=g.data[u],t.pointInsideRect(s.element,l,d))return e(s.element).off("CornerstoneToolsMouseMove",i),n.moveAllHandles(r,l,g,t.toolType,m,c),e(s.element).on("CornerstoneToolsMouseMove",i),r.stopImmediatePropagation(),!1}}return{enable:function(n){e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsMouseMove",i),e(n).off("CornerstoneToolsMouseDown",s),e(n).off("CornerstoneToolsMouseDownActivate",r),e(n).on("CornerstoneImageRendered",t.onImageRendered),o.updateImage(n)},disable:function(n){e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsMouseMove",i),e(n).off("CornerstoneToolsMouseDown",s),e(n).off("CornerstoneToolsMouseDownActivate",r),o.updateImage(n)},activate:function(n,a){var l={mouseButtonMask:a};e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsMouseMove",i),e(n).off("CornerstoneToolsMouseDown",s),e(n).off("CornerstoneToolsMouseDownActivate",r),e(n).on("CornerstoneImageRendered",t.onImageRendered),e(n).on("CornerstoneToolsMouseMove",l,i),e(n).on("CornerstoneToolsMouseDown",l,s),e(n).on("CornerstoneToolsMouseDownActivate",l,r),o.updateImage(n)},deactivate:function(n,a){var l={mouseButtonMask:a};e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsMouseMove",i),e(n).off("CornerstoneToolsMouseDown",s),e(n).off("CornerstoneToolsMouseDownActivate",r),e(n).on("CornerstoneImageRendered",t.onImageRendered),e(n).on("CornerstoneToolsMouseMove",l,i),e(n).on("CornerstoneToolsMouseDown",l,s),o.updateImage(n)}}}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t){"use strict";t.mouseWheelTool=function(o){return{activate:function(t){e(t).off("CornerstoneToolsMouseWheel",o);e(t).on("CornerstoneToolsMouseWheel",{},o)},disable:function(t){e(t).off("CornerstoneToolsMouseWheel",o)},enable:function(t){e(t).off("CornerstoneToolsMouseWheel",o)},deactivate:function(t){e(t).off("CornerstoneToolsMouseWheel",o)}}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.touchDragTool=function(o,t){var n="CornerstoneToolsTouchDrag";return t&&!0===t.fireOnTouchStart&&(n+=" CornerstoneToolsTouchStart"),{activate:function(a){e(a).off(n,o),t&&t.eventData?e(a).on(n,t.eventData,o):e(a).on(n,o),t&&t.activateCallback&&t.activateCallback(a)},disable:function(a){e(a).off(n,o),t&&t.disableCallback&&t.disableCallback(a)},enable:function(a){e(a).off(n,o),t&&t.enableCallback&&t.enableCallback(a)},deactivate:function(a){e(a).off(n,o),t&&t.deactivateCallback&&t.deactivateCallback(a)}}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.touchPinchTool=function(o){return{activate:function(t){e(t).off("CornerstoneToolsTouchPinch",o);e(t).on("CornerstoneToolsTouchPinch",{},o)},disable:function(t){e(t).off("CornerstoneToolsTouchPinch",o)},enable:function(t){e(t).off("CornerstoneToolsTouchPinch",o)},deactivate:function(t){e(t).off("CornerstoneToolsTouchPinch",o)}}}}($,cornerstone,cornerstoneTools),function(e,o,t,n){"use strict";function a(e){Object.keys(e).forEach((function(o){e[o].active=!1}))}function r(e){if(e)for(var o=0;o<e.data.length;o++){var t=e.data[o];t.active=!1,t.handles&&a(t.handles)}}n.touchTool=function(t){function a(r,l){return t.addNewMeasurement?t.addNewMeasurement(l):function(r){var l=r.element,c=t.createNewMeasurement(r);if(c){if(n.addToolState(l,t.toolType,c),1===Object.keys(c.handles).length&&"CornerstoneToolsTap"===r.type)return c.active=!1,c.handles.end.active=!1,c.handles.end.highlight=!1,c.invalidated=!0,n.anyHandlesOutsideImage(r,c.handles)&&n.removeToolState(l,t.toolType,c),void o.updateImage(l);e(l).off("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(l).off("CornerstoneToolsTap",t.tapCallback||i),e(l).off("CornerstoneToolsTouchStart",t.touchStartCallback||s),o.updateImage(l),n.moveNewHandleTouch(r,t.toolType,c,c.handles.end,(function(){c.active=!1,c.invalidated=!0,n.anyHandlesOutsideImage(r,c.handles)&&n.removeToolState(l,t.toolType,c),e(l).on("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(l).on("CornerstoneToolsTap",t.tapCallback||i),e(l).on("CornerstoneToolsTouchStart",t.touchStartCallback||s),o.updateImage(l)}))}}(l),!1}function i(s,l){var c,u,d=l.element,g=l.currentPoints.canvas,f=n.getToolState(s.currentTarget,t.toolType);function m(){r(f),n.anyHandlesOutsideImage(l,c.handles)&&n.removeToolState(d,t.toolType,c),o.updateImage(d),e(d).on("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(d).on("CornerstoneToolsTap",t.tapCallback||i)}if(r(f),f)for(u=0;u<f.data.length;u++){c=f.data[u];var h=n.getHandleNearImagePoint(d,c.handles,g,25);if(h)return e(d).off("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(d).off("CornerstoneToolsTap",t.tapCallback||i),c.active=!0,h.active=!0,o.updateImage(d),n.touchMoveHandle(s,t.toolType,c,h,m),s.stopImmediatePropagation(),!1}if(f&&t.pointNearTool)for(u=0;u<f.data.length;u++)if(c=f.data[u],t.pointNearTool(d,c,g))return e(d).off("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(d).off("CornerstoneToolsTap",t.tapCallback||i),c.active=!0,o.updateImage(d),n.touchMoveAllHandles(s,c,f,t.toolType,!0,m),s.stopImmediatePropagation(),!1;return t.touchDownActivateCallback?t.touchDownActivateCallback(s,l):a(0,l),!1}function s(r,s){var l,c,u=s.element,d=s.startPoints.canvas,g=n.getToolState(r.currentTarget,t.toolType);function f(r,c){if(l.active=!1,l.invalidated=!0,n.anyHandlesOutsideImage(s,l.handles)&&n.removeToolState(s.element,t.toolType,l),o.updateImage(s.element),e(u).on("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(u).on("CornerstoneToolsTap",t.tapCallback||i),t.pressCallback&&e(u).on("CornerstoneToolsTouchPress",t.pressCallback),r&&"CornerstoneToolsTouchPress"===r.type){var d=e.Event(r.type,c);e(u).trigger(d,c)}}if(g){for(c=0;c<g.data.length;c++){l=g.data[c];var m=n.getHandleNearImagePoint(s.element,l.handles,d,28);if(m)return e(u).off("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(u).off("CornerstoneToolsTap",t.tapCallback||i),t.pressCallback&&e(u).off("CornerstoneToolsTouchPress",t.pressCallback),l.active=!0,n.touchMoveHandle(r,t.toolType,l,m,f),r.stopImmediatePropagation(),!1}if(t.pointNearTool)for(c=0;c<g.data.length;c++)if(l=g.data[c],t.pointNearTool(s.element,l,d))return e(u).off("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(u).off("CornerstoneToolsTap",t.tapCallback||i),t.pressCallback&&e(u).off("CornerstoneToolsTouchPress",t.pressCallback),n.touchMoveAllHandles(r,l,g,t.toolType,!0,f),r.stopImmediatePropagation(),!1}}var l={enable:function(n){e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsTouchStart",t.touchStartCallback||s),e(n).off("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(n).off("CornerstoneToolsTap",t.tapCallback||i),e(n).on("CornerstoneImageRendered",t.onImageRendered),t.doubleTapCallback&&e(n).off("CornerstoneToolsDoubleTap",t.doubleTapCallback),t.pressCallback&&e(n).off("CornerstoneToolsTouchPress",t.pressCallback),o.updateImage(n)},disable:function(n){e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsTouchStart",t.touchStartCallback||s),e(n).off("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(n).off("CornerstoneToolsTap",t.tapCallback||i),t.doubleTapCallback&&e(n).off("CornerstoneToolsDoubleTap",t.doubleTapCallback),t.pressCallback&&e(n).off("CornerstoneToolsTouchPress",t.pressCallback),o.updateImage(n)},activate:function(n){e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsTouchStart",t.touchStartCallback||s),e(n).off("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(n).off("CornerstoneToolsTap",t.tapCallback||i),e(n).on("CornerstoneImageRendered",t.onImageRendered),e(n).on("CornerstoneToolsTouchStart",t.touchStartCallback||s),e(n).on("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(n).on("CornerstoneToolsTap",t.tapCallback||i),t.doubleTapCallback&&(e(n).off("CornerstoneToolsDoubleTap",t.doubleTapCallback),e(n).on("CornerstoneToolsDoubleTap",t.doubleTapCallback)),t.pressCallback&&(e(n).off("CornerstoneToolsTouchPress",t.pressCallback),e(n).on("CornerstoneToolsTouchPress",t.pressCallback)),o.updateImage(n)},deactivate:function(n){var r="CornerstoneToolsToolDeactivated",l={toolType:t.toolType,type:r},c=e.Event(r,l);e(n).trigger(c,l),e(n).off("CornerstoneImageRendered",t.onImageRendered),e(n).off("CornerstoneToolsTouchStart",t.touchStartCallback||s),e(n).off("CornerstoneToolsTouchStartActive",t.touchDownActivateCallback||a),e(n).off("CornerstoneToolsTap",t.tapCallback||i),e(n).on("CornerstoneImageRendered",t.onImageRendered),t.doubleTapCallback&&e(n).off("CornerstoneToolsDoubleTap",t.doubleTapCallback),t.pressCallback&&e(n).off("CornerstoneToolsTouchPress",t.pressCallback),o.updateImage(n)},touchStartCallback:t.touchStartCallback||s,touchDownActivateCallback:t.touchDownActivateCallback||a,tapCallback:t.tapCallback||i};return t.pointNearTool&&(l.pointNearTool=t.pointNearTool),t.doubleTapCallback&&(l.doubleTapCallback=t.doubleTapCallback),t.pressCallback&&(l.pressCallback=t.pressCallback),t.addNewMeasurement&&(l.addNewMeasurement=t.addNewMeasurement),l}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t,n){"use strict";function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y+20,highlight:!0,active:!1}}}}function r(e,n,a){var r={start:o.pixelToCanvas(e,n.handles.start),end:o.pixelToCanvas(e,n.handles.end)},i=t.lineSegment.distanceToPoint(r,a);return i<5||(r.start=o.pixelToCanvas(e,n.handles.start2),r.end=o.pixelToCanvas(e,n.handles.end2),(i=t.lineSegment.distanceToPoint(r,a))<5)}function i(e,t){var a=n.getToolState(e.currentTarget,"angle");if(void 0!==a){var r,i=t.canvasContext.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);for(var s=n.toolStyle.getToolWidth(),l=n.textStyle.getFont(),c=n.angle.getConfiguration(),u=0;u<a.data.length;u++){i.save(),c&&c.shadow&&(i.shadowColor=c.shadowColor||"#000000",i.shadowOffsetX=c.shadowOffsetX||1,i.shadowOffsetY=c.shadowOffsetY||1);var d=a.data[u];r=d.active?n.toolColors.getActiveColor():n.toolColors.getToolColor(),i.beginPath(),i.strokeStyle=r,i.lineWidth=s;var g=o.pixelToCanvas(t.element,d.handles.start),f=o.pixelToCanvas(t.element,d.handles.end);i.moveTo(g.x,g.y),i.lineTo(f.x,f.y),g=o.pixelToCanvas(t.element,d.handles.start2),f=o.pixelToCanvas(t.element,d.handles.end2),i.moveTo(g.x,g.y),i.lineTo(f.x,f.y),i.stroke(),n.drawHandles(i,t,d.handles),i.fillStyle=r;var m=(Math.ceil(d.handles.start.x)-Math.ceil(d.handles.end.x))*t.image.columnPixelSpacing,h=(Math.ceil(d.handles.start.y)-Math.ceil(d.handles.end.y))*t.image.rowPixelSpacing,v=(Math.ceil(d.handles.start2.x)-Math.ceil(d.handles.end2.x))*t.image.columnPixelSpacing,T=(Math.ceil(d.handles.start2.y)-Math.ceil(d.handles.end2.y))*t.image.rowPixelSpacing,p=Math.acos(Math.abs((m*v+h*T)/(Math.sqrt(m*m+h*h)*Math.sqrt(v*v+T*T))));p*=180/Math.PI;var C=n.roundToDecimal(p,2).toString()+String.fromCharCode(parseInt("00B0",16)),x=(g.x+f.x)/2,M=(g.y+f.y)/2;i.font=l,n.drawTextBox(i,C,x,M,r),i.restore()}}}n.angle=n.mouseButtonTool({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:"angle"}),n.angleTouch=n.touchTool({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:"angle"})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t,n){"use strict";var a="arrowAnnotate";var r={getTextCallback:function(e){e(prompt("Enter your annotation:"))},changeTextCallback:function(e,o,t){t(prompt("Change your annotation:"))},drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0};function i(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function s(e,n,a){var r={start:o.pixelToCanvas(e,n.handles.start),end:o.pixelToCanvas(e,n.handles.end)};return t.lineSegment.distanceToPoint(r,a)<25}function l(e,r){var i=n.getToolState(e.currentTarget,a);if(i){var s,l=r.enabledElement,c=r.canvasContext.canvas.getContext("2d");c.setTransform(1,0,0,1,0,0);for(var u=n.toolStyle.getToolWidth(),d=n.textStyle.getFont(),g=n.arrowAnnotate.getConfiguration(),f=0;f<i.data.length;f++){c.save(),g&&g.shadow&&(c.shadowColor=g.shadowColor||"#000000",c.shadowOffsetX=g.shadowOffsetX||1,c.shadowOffsetY=g.shadowOffsetY||1);var m=i.data[f];s=m.active?n.toolColors.getActiveColor():n.toolColors.getToolColor();var h=o.pixelToCanvas(r.element,m.handles.start),v=o.pixelToCanvas(r.element,m.handles.end);g.arrowFirst?n.drawArrow(c,v,h,s,u):n.drawArrow(c,h,v,s,u);var T={drawHandlesIfActive:g&&g.drawHandlesOnHover};if(g.drawHandles&&n.drawHandles(c,r,m.handles,s,T),m.text&&""!==m.text){c.font=d;var p,C=c.measureText(m.text).width+10,x=n.textStyle.getFontSize()+10,M=Math.max(C,x)/2+5;if(v.x<h.x&&(M=-M),!m.handles.textBox.hasMoved){p=g.arrowFirst?{x:v.x-C/2+M,y:v.y-x/2}:{x:h.x-C/2-M,y:h.y-x/2};var y=o.internal.getTransform(l);y.invert();var w=y.transformPoint(p.x,p.y);m.handles.textBox.x=w.x,m.handles.textBox.y=w.y}p=o.pixelToCanvas(r.element,m.handles.textBox);var b=n.drawTextBox(c,m.text,p.x,p.y,s);if(m.handles.textBox.boundingBox=b,m.handles.textBox.hasMoved){var P={start:{},end:{}},I=[h,v,{x:(h.x+v.x)/2,y:(h.y+v.y)/2}];P.end.x=p.x,P.end.y=p.y,P.start=t.point.findClosestPoint(I,P.end);var S=[{x:b.left+b.width/2,y:b.top},{x:b.left,y:b.top+b.height/2},{x:b.left+b.width/2,y:b.top+b.height},{x:b.left+b.width,y:b.top+b.height/2}];P.end=t.point.findClosestPoint(S,P.start),c.beginPath(),c.strokeStyle=s,c.lineWidth=u,c.setLineDash([2,3]),c.moveTo(P.start.x,P.start.y),c.lineTo(P.end.x,P.end.y),c.stroke()}}c.restore()}}}n.arrowAnnotate=n.mouseButtonTool({addNewMeasurement:function(t){var r=i(t),s={mouseButtonMask:t.which};function l(i){null!==i?r.text=i:n.removeToolState(t.element,a,r),r.active=!1,o.updateImage(t.element),e(t.element).on("CornerstoneToolsMouseMove",s,n.arrowAnnotate.mouseMoveCallback),e(t.element).on("CornerstoneToolsMouseDown",s,n.arrowAnnotate.mouseDownCallback),e(t.element).on("CornerstoneToolsMouseDownActivate",s,n.arrowAnnotate.mouseDownActivateCallback),e(t.element).on("CornerstoneToolsMouseDoubleClick",s,n.arrowAnnotate.mouseDoubleClickCallback)}n.addToolState(t.element,a,r),e(t.element).off("CornerstoneToolsMouseMove",n.arrowAnnotate.mouseMoveCallback),e(t.element).off("CornerstoneToolsMouseDown",n.arrowAnnotate.mouseDownCallback),e(t.element).off("CornerstoneToolsMouseDownActivate",n.arrowAnnotate.mouseDownActivateCallback),e(t.element).off("CornerstoneToolsMouseDoubleClick",n.arrowAnnotate.mouseDoubleClickCallback),o.updateImage(t.element),n.moveNewHandle(t,a,r,r.handles.end,(function(){n.anyHandlesOutsideImage(t,r.handles)&&n.removeToolState(t.element,a,r);var e=n.arrowAnnotate.getConfiguration();void 0===r.text&&e.getTextCallback(l),o.updateImage(t.element)}))},createNewMeasurement:i,onImageRendered:l,pointNearTool:s,toolType:a,mouseDoubleClickCallback:function(e,t){var r,i=t.element;function l(e,t){!0===t?n.removeToolState(i,a,r):r.text=e,r.active=!1,o.updateImage(i)}if(e.data&&e.data.mouseButtonMask&&!n.isMouseButtonEnabled(t.which,e.data.mouseButtonMask))return!1;var c=n.arrowAnnotate.getConfiguration(),u=t.currentPoints.canvas,d=n.getToolState(i,a);if(!d)return!1;for(var g=0;g<d.data.length;g++)if(r=d.data[g],s(i,r,u)||n.pointInsideBoundingBox(r.handles.textBox,u))return r.active=!0,o.updateImage(i),c.changeTextCallback(r,t,l),e.stopImmediatePropagation(),!1;return!1}}),n.arrowAnnotate.setConfiguration(r),n.arrowAnnotateTouch=n.touchTool({addNewMeasurement:function(t){var r=t.element,s=i(t);function l(t){null!==t?s.text=t:n.removeToolState(r,a,s),s.active=!1,o.updateImage(r),e(r).on("CornerstoneToolsTouchPress",n.arrowAnnotateTouch.pressCallback),e(r).on("CornerstoneToolsTouchStartActive",n.arrowAnnotateTouch.touchDownActivateCallback),e(r).on("CornerstoneToolsTap",n.arrowAnnotateTouch.tapCallback)}n.addToolState(r,a,s),e(r).off("CornerstoneToolsTouchPress",n.arrowAnnotateTouch.pressCallback),e(r).off("CornerstoneToolsTouchStartActive",n.arrowAnnotateTouch.touchDownActivateCallback),e(r).off("CornerstoneToolsTap",n.arrowAnnotateTouch.tapCallback),o.updateImage(r),n.moveNewHandleTouch(t,a,s,s.handles.end,(function(){o.updateImage(r),n.anyHandlesOutsideImage(t,s.handles)&&n.removeToolState(r,a,s);var e=n.arrowAnnotate.getConfiguration();void 0===s.text&&e.getTextCallback(l)}))},createNewMeasurement:i,onImageRendered:l,pointNearTool:s,toolType:a,pressCallback:function(t,r){var i,l=r.element;function c(t,r){console.log("pressCallback doneChangingTextCallback"),!0===r?n.removeToolState(l,a,i):i.text=t,i.active=!1,o.updateImage(l),e(l).on("CornerstoneToolsTouchStart",n.arrowAnnotateTouch.touchStartCallback),e(l).on("CornerstoneToolsTouchStartActive",n.arrowAnnotateTouch.touchDownActivateCallback),e(l).on("CornerstoneToolsTap",n.arrowAnnotateTouch.tapCallback)}if(t.data&&t.data.mouseButtonMask&&!n.isMouseButtonEnabled(r.which,t.data.mouseButtonMask))return!1;var u=n.arrowAnnotate.getConfiguration(),d=r.currentPoints.canvas,g=n.getToolState(l,a);if(!g)return!1;if(r.handlePressed)return e(l).off("CornerstoneToolsTouchStart",n.arrowAnnotateTouch.touchStartCallback),e(l).off("CornerstoneToolsTouchStartActive",n.arrowAnnotateTouch.touchDownActivateCallback),e(l).off("CornerstoneToolsTap",n.arrowAnnotateTouch.tapCallback),u.changeTextCallback(r.handlePressed,r,c),t.stopImmediatePropagation(),!1;for(var f=0;f<g.data.length;f++)if(i=g.data[f],s(l,i,d)||n.pointInsideBoundingBox(i.handles.textBox,d))return i.active=!0,o.updateImage(l),e(l).off("CornerstoneToolsTouchStart",n.arrowAnnotateTouch.touchStartCallback),e(l).off("CornerstoneToolsTouchStartActive",n.arrowAnnotateTouch.touchDownActivateCallback),e(l).off("CornerstoneToolsTap",n.arrowAnnotateTouch.tapCallback),u.changeTextCallback(i,r,c),t.stopImmediatePropagation(),!1;return!1}})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t){"use strict";function n(n,a){n.stopImmediatePropagation();var r=t.getToolState(n.currentTarget,"crosshairs");if(r){var i=n.currentTarget,s=o.getEnabledElement(i).image.imageId,l=t.metaData.get("imagePlane",s),c=a.currentPoints.image,u=t.imagePointToPatientPoint(c,l),d=r.data[0].synchronizationContext.getSourceElements();e.each(d,(function(n,a){if(a!==i){var r=Number.MAX_VALUE,s=-1,l=t.getToolState(a,"stack");if(void 0!==l){var c=l.data[0];if(e.each(c.imageIds,(function(e,o){var n=t.metaData.get("imagePlane",o),a=n.imagePositionPatient,i=n.rowCosines.clone(),l=n.columnCosines.clone().clone().cross(i.clone()),c=Math.abs(l.clone().dot(a)-l.clone().dot(u));c<r&&(r=c,s=e)})),s!==c.currentImageIdIndex&&-1!==s&&void 0!==c.imageIds[s]){var d=t.loadHandlerManager.getStartLoadHandler(),g=t.loadHandlerManager.getEndLoadHandler(),f=t.loadHandlerManager.getErrorLoadingHandler();d&&d(a),(!0===c.preventCache?o.loadImage(c.imageIds[s]):o.loadAndCacheImage(c.imageIds[s])).then((function(e){var t=o.getViewport(a);c.currentImageIdIndex=s,o.displayImage(a,e,t),g&&g(a)}),(function(e){var o=c.imageIds[s];f&&f(a,o,e)}))}}}}))}}function a(o,t){e(t.element).off("CornerstoneToolsMouseDrag",i),e(t.element).off("CornerstoneToolsMouseUp",a)}function r(o,r){if(t.isMouseButtonEnabled(r.which,o.data.mouseButtonMask))return e(r.element).on("CornerstoneToolsMouseDrag",i),e(r.element).on("CornerstoneToolsMouseUp",a),n(o,r),!1}function i(e,o){return n(e,o),!1}function s(o,n,a){var i={mouseButtonMask:n};t.getToolState(o,"crosshairs");t.addToolState(o,"crosshairs",{synchronizationContext:a}),e(o).off("CornerstoneToolsMouseDown",r),e(o).on("CornerstoneToolsMouseDown",i,r)}function l(o){e(o).off("CornerstoneToolsMouseDown",r)}function c(o,t){e(t.element).off("CornerstoneToolsTouchDrag",d),e(t.element).off("CornerstoneToolsDragEnd",c)}function u(o,t){return e(t.element).on("CornerstoneToolsTouchDrag",d),e(t.element).on("CornerstoneToolsDragEnd",c),n(o,t),!1}function d(e,o){return n(e,o),!1}function g(o,n){t.getToolState(o,"crosshairs");t.addToolState(o,"crosshairs",{synchronizationContext:n}),e(o).off("CornerstoneToolsTouchStart",u),e(o).on("CornerstoneToolsTouchStart",u)}function f(o){e(o).off("CornerstoneToolsTouchStart",u)}t.crosshairs={activate:s,deactivate:l,enable:s,disable:l},t.crosshairsTouch={activate:g,deactivate:f,enable:g,disable:f}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.displayTool=function(t){var n={};return{disable:function(o){e(o).off("CornerstoneImageRendered",t)},enable:function(n){e(n).off("CornerstoneImageRendered",t),e(n).on("CornerstoneImageRendered",t),o.updateImage(n)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.doubleTapTool=function(o){return{activate:function(t){e(t).off("CornerstoneToolsDoubleTap",o);e(t).on("CornerstoneToolsDoubleTap",{},o)},disable:function(t){e(t).off("CornerstoneToolsDoubleTap",o)},enable:function(t){e(t).off("CornerstoneToolsDoubleTap",o)},deactivate:function(t){e(t).off("CornerstoneToolsDoubleTap",o)}}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";function n(e){o.fitToWindow(e.element)}t.doubleTapZoom=t.doubleTapTool((function(e,o){return t.doubleTapZoom.strategy(o),!1})),t.doubleTapZoom.strategies={default:n},t.doubleTapZoom.strategy=n}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";function n(e){var n=o.getEnabledElement(e.element);o.updateImage(e.element);var a=n.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);var r=t.toolColors.getActiveColor(),i=t.textStyle.getFont(),s=t.textStyle.getFontSize(),l=t.dragProbe.getConfiguration();a.save(),l&&l.shadow&&(a.shadowColor=l.shadowColor||"#000000",a.shadowOffsetX=l.shadowOffsetX||1,a.shadowOffsetY=l.shadowOffsetY||1);var c,u,d,g=Math.round(e.currentPoints.image.x),f=Math.round(e.currentPoints.image.y);if(!(g<0||f<0||g>=e.image.columns||f>=e.image.rows)){if(e.image.color)u=g+", "+f,d="R: "+(c=t.getRGBPixels(e.element,g,f,1,1))[0]+" G: "+c[1]+" B: "+c[2]+" A: "+c[3];else{var m=(c=o.getStoredPixels(e.element,g,f,1,1))[0],h=m*e.image.slope+e.image.intercept,v=t.calculateSUV(e.image,m);u=g+", "+f,d="SP: "+m+" MO: "+parseFloat(h.toFixed(3)),v&&(d+=" SUV: "+parseFloat(v.toFixed(3)))}var T={x:e.currentPoints.image.x+3,y:e.currentPoints.image.y-3},p=o.pixelToCanvas(e.element,T);a.font=i,a.fillStyle=r,t.drawTextBox(a,d,p.x,p.y+s+5,r),t.drawTextBox(a,u,p.x,p.y,r),a.restore()}}function a(t,n){e(n.element).off("CornerstoneToolsMouseDrag",r),e(n.element).off("CornerstoneToolsMouseUp",a),e(n.element).off("CornerstoneToolsMouseClick",a),o.updateImage(n.element)}function r(e,o){return t.dragProbe.strategy(o),!1}t.dragProbe=t.simpleMouseButtonTool((function(o,n){if(t.isMouseButtonEnabled(n.which,o.data.mouseButtonMask))return e(n.element).on("CornerstoneToolsMouseDrag",r),e(n.element).on("CornerstoneToolsMouseUp",a),e(n.element).on("CornerstoneToolsMouseClick",a),t.dragProbe.strategy(n),!1})),t.dragProbe.strategies={default:n,minimal:function(e){var n=e.element,a=o.getEnabledElement(n),r=a.image;o.updateImage(n);var i=a.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);var s,l,c=t.toolColors.getActiveColor(),u=t.textStyle.getFont(),d=t.dragProbe.getConfiguration();i.save(),d&&d.shadow&&(i.shadowColor=d.shadowColor||"#000000",i.shadowOffsetX=d.shadowOffsetX||1,i.shadowOffsetY=d.shadowOffsetY||1);var g="";if(!((s=!0===e.isTouchEvent?o.pageToPixel(n,e.currentPoints.page.x,e.currentPoints.page.y-4*t.textStyle.getFontSize()):o.pageToPixel(n,e.currentPoints.page.x,e.currentPoints.page.y-t.textStyle.getFontSize()/2)).x<0||s.y<0||s.x>=r.columns||s.y>=r.rows)){if(r.color)g="R: "+(l=t.getRGBPixels(n,s.x,s.y,1,1))[0]+" G: "+l[1]+" B: "+l[2];else{var f,m=(l=o.getStoredPixels(n,s.x,s.y,1,1))[0],h=m*e.image.slope+e.image.intercept,v=t.calculateSUV(e.image,m);e.image.data&&(f=e.image.data.string("x00080060")),"CT"===f&&(g+="HU: "),g+=parseFloat(h.toFixed(2)),v&&(g+=" SUV: "+parseFloat(v.toFixed(2)))}var T,p=o.pixelToCanvas(n,s);i.font=u,i.fillStyle=c;var C=i.measureText(g).width;T=!0===e.isTouchEvent?{x:-C/2-5,y:-t.textStyle.getFontSize()-10-12}:{x:12,y:-(t.textStyle.getFontSize()+10)/2},i.beginPath(),i.strokeStyle=c,i.arc(p.x,p.y,6,0,2*Math.PI),i.stroke(),t.drawTextBox(i,g,p.x+T.x,p.y+T.y,c),i.restore()}}},t.dragProbe.strategy=n;t.dragProbeTouch=t.touchDragTool(r,{fireOnTouchStart:!0})}($,cornerstone,cornerstoneTools),function(e,o,t,n){"use strict";function a(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,o){var t=e.width/2,n=e.height/2;if(t<=0||n<=0)return!1;var a=e.left+t,r=e.top+n,i=o.x-a,s=o.y-r;return i*i/(t*t)+s*s/(n*n)<=1}function i(e,o){for(var t=0,n=0,a=0,i=0,s=o.top;s<o.top+o.height;s++)for(var l=o.left;l<o.left+o.width;l++)!0===r(o,{x:l,y:s})&&(t+=e[i],n+=e[i]*e[i],a++),i++;if(0===a)return{count:a,mean:0,variance:0,stdDev:0};var c=t/a,u=n/a-c*c;return{count:a,mean:c,variance:u,stdDev:Math.sqrt(u)}}function s(e,t,n,a){var i=o.pixelToCanvas(e,t.handles.start),s=o.pixelToCanvas(e,t.handles.end),l={left:Math.min(i.x,s.x)+a/2,top:Math.min(i.y,s.y)+a/2,width:Math.abs(i.x-s.x)-a,height:Math.abs(i.y-s.y)-a},c={left:Math.min(i.x,s.x)-a/2,top:Math.min(i.y,s.y)-a/2,width:Math.abs(i.x-s.x)+a,height:Math.abs(i.y-s.y)+a},u=r(l,n);return!(!r(c,n)||u)}function l(e){var o=e.toString().split(".");return o[0]=o[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),o.join(".")}function c(e,a){var r=n.getToolState(e.currentTarget,"ellipticalRoi");if(r){var s=a.image,c=a.element,u=n.toolStyle.getToolWidth(),d=n.ellipticalRoi.getConfiguration(),g=a.canvasContext.canvas.getContext("2d");g.setTransform(1,0,0,1,0,0);var f;s.data&&(f=s.data.string("x00080060"));for(var m=0;m<r.data.length;m++){g.save();var h=r.data[m];d&&d.shadow&&(g.shadowColor=d.shadowColor||"#000000",g.shadowOffsetX=d.shadowOffsetX||1,g.shadowOffsetY=d.shadowOffsetY||1);var v,T,p,C=n.toolColors.getColorIfActive(h.active),x=o.pixelToCanvas(c,h.handles.start),M=o.pixelToCanvas(c,h.handles.end),y=Math.min(x.x,M.x),w=Math.min(x.y,M.y),b=Math.abs(x.x-M.x),P=Math.abs(x.y-M.y);if(g.beginPath(),g.strokeStyle=C,g.lineWidth=u,n.drawEllipse(g,y,w,b,P),g.closePath(),d&&d.drawHandlesOnHover)if(!0===h.active)n.drawHandles(g,a,h.handles,C);else{n.drawHandles(g,a,h.handles,C,{drawHandlesIfActive:!0})}else n.drawHandles(g,a,h.handles,C);if(h.invalidated){var I={left:Math.min(h.handles.start.x,h.handles.end.x),top:Math.min(h.handles.start.y,h.handles.end.y),width:Math.abs(h.handles.start.x-h.handles.end.x),height:Math.abs(h.handles.start.y-h.handles.end.y)};if(!s.color)T=i(o.getPixels(c,I.left,I.top,I.width,I.height),I),"PT"===f&&(p={mean:n.calculateSUV(s,(T.mean-s.intercept)/s.slope),stdDev:n.calculateSUV(s,(T.stdDev-s.intercept)/s.slope)}),T&&!isNaN(T.mean)&&(h.meanStdDev=T,h.meanStdDevSUV=p);var S=s.columnPixelSpacing||1,k=s.rowPixelSpacing||1;v=Math.PI*(I.width*S/2)*(I.height*k/2),isNaN(v)||(h.area=v),h.invalidated=!1}else T=h.meanStdDev,p=h.meanStdDevSUV,v=h.area;var D=[];if(T&&T.mean){var E="";"CT"===f&&(E=" HU");var A="Mean: "+l(T.mean.toFixed(2))+E,R="StdDev: "+l(T.stdDev.toFixed(2))+E;if(p&&void 0!==p.mean){A+=" SUV: "+l(p.mean.toFixed(2)),R+=" SUV: "+l(p.stdDev.toFixed(2))}D.push(A),D.push(R)}if(v){var H=" mm"+String.fromCharCode(178);s.rowPixelSpacing&&s.columnPixelSpacing||(H=" pixels"+String.fromCharCode(178));var B="Area: "+l(v.toFixed(2))+H;D.push(B)}h.handles.textBox.hasMoved||(h.handles.textBox.x=Math.max(h.handles.start.x,h.handles.end.x),h.handles.textBox.y=(h.handles.start.y+h.handles.end.y)/2);var O=o.pixelToCanvas(c,h.handles.textBox),N=n.drawTextBox(g,D,O.x,O.y,C,{centering:{x:!1,y:!0}});if(h.handles.textBox.boundingBox=N,h.handles.textBox.hasMoved){var L={start:{},end:{x:O.x,y:O.y}},V=[{x:y+b/2,y:w},{x:y,y:w+P/2},{x:y+b/2,y:w+P},{x:y+b,y:w+P/2}];L.start=t.point.findClosestPoint(V,L.end);var Y=[{x:N.left+N.width/2,y:N.top},{x:N.left,y:N.top+N.height/2},{x:N.left+N.width/2,y:N.top+N.height},{x:N.left+N.width,y:N.top+N.height/2}];L.end=t.point.findClosestPoint(Y,L.start),g.beginPath(),g.strokeStyle=C,g.lineWidth=u,g.setLineDash([2,3]),g.moveTo(L.start.x,L.start.y),g.lineTo(L.end.x,L.end.y),g.stroke()}g.restore()}}}n.ellipticalRoi=n.mouseButtonTool({createNewMeasurement:a,onImageRendered:c,pointNearTool:function(e,o,t){return s(e,o,t,15)},toolType:"ellipticalRoi"}),n.ellipticalRoiTouch=n.touchTool({createNewMeasurement:a,onImageRendered:c,pointNearTool:function(e,o,t){return s(e,o,t,25)},toolType:"ellipticalRoi"})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t,n){"use strict";var a={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},freehand:!1,modifying:!1,currentHandle:0,currentTool:-1};function r(e){var t=n.getToolState(e.element,"freehand");if(void 0!==t){var a=n.freehand.getConfiguration(),r=t.data[a.currentTool],i={x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,lines:[]};r.handles.length&&r.handles[a.currentHandle-1].lines.push(e.currentPoints.image),r.handles.push(i),a.currentHandle+=1,a.freehand=!1,o.updateImage(e.element)}}function i(e,a){var r=n.getToolState(e.element,"freehand");if(void 0!==r){var i=r.data[a];if(void 0!==i.handles)for(var s=e.currentPoints.canvas,l=0;l<i.handles.length;l++){var c=o.pixelToCanvas(e.element,i.handles[l]);if(t.point.distance(c,s)<5)return l}}}function s(t,a){if(e(a.element).off("CornerstoneToolsMouseUp",s),void 0!==n.getToolState(a.element,"freehand")){var r=n.freehand.getConfiguration();a.event.shiftKey||(r.freehand=!1),o.updateImage(a.element)}}function l(e,t){var a=n.getToolState(t.element,"freehand");if(a){var r=n.freehand.getConfiguration(),s=a.data[r.currentTool],l=Math.max(t.currentPoints.image.x,0);l=Math.min(l,t.image.width),r.mouseLocation.handles.start.x=l;var c=Math.max(t.currentPoints.image.y,0);c=Math.min(c,t.image.height),r.mouseLocation.handles.start.y=c;var u=r.currentHandle;if(r.modifying&&(s.active=!0,s.highlight=!0,s.handles[u].x=r.mouseLocation.handles.start.x,s.handles[u].y=r.mouseLocation.handles.start.y,u)){var d=s.handles[u-1].lines.length-1,g=s.handles[u-1].lines[d];g.x=r.mouseLocation.handles.start.x,g.y=r.mouseLocation.handles.start.y}if(r.freehand)s.handles[u-1].lines.push(t.currentPoints.image);else{var f=i(t,r.currentTool);void 0!==f&&f<s.handles.length-1&&(r.mouseLocation.handles.start.x=s.handles[f].x,r.mouseLocation.handles.start.y=s.handles[f].y)}o.updateImage(t.element)}}function c(t,a){var r=n.getToolState(t.element,"freehand");if(r){var i=n.freehand.getConfiguration(),s=r.data[i.currentTool];s.active=!1,s.highlight=!1,void 0!==a&&s.handles[i.currentHandle-1].lines.push(s.handles[a]),i.modifying&&(i.modifying=!1),i.currentHandle=0,i.currentTool=-1,e(t.element).off("CornerstoneToolsMouseMove",l),o.updateImage(t.element)}}function u(o,t){if(n.isMouseButtonEnabled(t.which,o.data.mouseButtonMask)){var a,u,d=n.getToolState(t.element,"freehand"),g=n.freehand.getConfiguration(),f=g.currentTool;if(g.modifying)return void c(t);if(f<0){var m=function(e){var o=n.getToolState(e.element,"freehand");if(o)for(var t,a=0;a<o.data.length;a++)if(void 0!==(t=i(e,a)))return{handleNearby:t,toolIndex:a}}(t);m?(a=m.handleNearby,u=m.toolIndex,void 0!==a&&(e(t.element).on("CornerstoneToolsMouseMove",l),e(t.element).on("CornerstoneToolsMouseUp",s),g.modifying=!0,g.currentHandle=a,g.currentTool=u)):(!function(o){e(o.element).on("CornerstoneToolsMouseMove",l),e(o.element).on("CornerstoneToolsMouseUp",s);var t=n.freehand.getConfiguration();t.mouseLocation.handles.start.x=o.currentPoints.image.x,t.mouseLocation.handles.start.y=o.currentPoints.image.y,n.addToolState(o.element,"freehand",{visible:!0,active:!0,handles:[]});var a=n.getToolState(o.element,"freehand");t.currentTool=a.data.length-1}(t),r(t))}else f>=0&&d.data[f].active&&(void 0!==(a=i(t,f))?c(t,a):t.event.shiftKey?g.freehand=!0:r(t));return!1}}function d(e,t){var a=n.getToolState(e.currentTarget,"freehand");if(void 0!==a){var r,i=n.freehand.getConfiguration(),s=t.canvasContext.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0);for(var l=n.toolStyle.getToolWidth(),c=n.toolColors.getFillColor(),u=0;u<a.data.length;u++){s.save();var d,g=a.data[u];if(g.active?(r=n.toolColors.getActiveColor(),c=n.toolColors.getFillColor()):(r=n.toolColors.getToolColor(),c=n.toolColors.getToolColor()),g.handles.length)for(var f=0;f<g.handles.length;f++){d=g.handles[f];var m=o.pixelToCanvas(t.element,d);s.beginPath(),s.strokeStyle=r,s.lineWidth=l,s.moveTo(m.x,m.y);for(var h=0;h<g.handles[f].lines.length;h++){var v=o.pixelToCanvas(t.element,g.handles[f].lines[h]);s.lineTo(v.x,v.y),s.stroke()}var T=o.pixelToCanvas(t.element,i.mouseLocation.handles.start);f===g.handles.length-1&&(!g.active||i.freehand||i.modifying||(s.lineTo(T.x,T.y),s.stroke()))}var p={fill:c};g.active&&n.drawHandles(s,t,i.mouseLocation.handles,r,p),n.drawHandles(s,t,g.handles,r,p),s.restore()}}}n.freehand={enable:function(t){e(t).off("CornerstoneToolsMouseDown",u),e(t).off("CornerstoneToolsMouseUp",s),e(t).off("CornerstoneToolsMouseMove",l),e(t).off("CornerstoneImageRendered",d),e(t).on("CornerstoneImageRendered",d),o.updateImage(t)},disable:function(t){e(t).off("CornerstoneToolsMouseDown",u),e(t).off("CornerstoneToolsMouseUp",s),e(t).off("CornerstoneToolsMouseMove",l),e(t).off("CornerstoneImageRendered",d),o.updateImage(t)},activate:function(t,n){var a={mouseButtonMask:n};e(t).off("CornerstoneToolsMouseDown",a,u),e(t).off("CornerstoneToolsMouseUp",s),e(t).off("CornerstoneToolsMouseMove",l),e(t).off("CornerstoneImageRendered",d),e(t).on("CornerstoneImageRendered",d),e(t).on("CornerstoneToolsMouseDown",a,u),o.updateImage(t)},deactivate:function(t){e(t).off("CornerstoneToolsMouseDown",u),e(t).off("CornerstoneToolsMouseUp",s),e(t).off("CornerstoneToolsMouseMove",l),e(t).off("CornerstoneImageRendered",d),e(t).on("CornerstoneImageRendered",d),o.updateImage(t)},getConfiguration:function(){return a},setConfiguration:function(e){a=e}}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t,n){"use strict";function a(e){var o=n.getToolState(e.event.currentTarget,"highlight");if(!(o&&o.data&&o.data.length>0))return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function r(e,t,n){var a=o.pixelToCanvas(e,t.handles.start),r=o.pixelToCanvas(e,t.handles.end),i=Math.min(a.x,r.x),s=Math.min(a.y,r.y),l=Math.abs(a.x-r.x),c=Math.abs(a.y-r.y),u=!1;return n.x>=i&&n.x<=i+l&&n.y>=s&&n.y<=s+c&&(u=!0),u}function i(e,n,a){var r=o.pixelToCanvas(e,n.handles.start),i=o.pixelToCanvas(e,n.handles.end),s={left:Math.min(r.x,i.x),top:Math.min(r.y,i.y),width:Math.abs(r.x-i.x),height:Math.abs(r.y-i.y)};return t.rect.distanceToPoint(s,a)<5}function s(e,t){var a=n.getToolState(e.currentTarget,"highlight");if(void 0!==a){var r,i=t.canvasContext.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);var s=n.toolStyle.getToolWidth();i.save();var l=a.data[0];if(l){r=l.active?n.toolColors.getActiveColor():n.toolColors.getToolColor();var c=o.pixelToCanvas(t.element,l.handles.start),u=o.pixelToCanvas(t.element,l.handles.end),d={left:Math.min(c.x,u.x),top:Math.min(c.y,u.y),width:Math.abs(c.x-u.x),height:Math.abs(c.y-u.y)};i.beginPath(),i.strokeStyle="transparent",i.rect(0,0,i.canvas.clientWidth,i.canvas.clientHeight),i.rect(d.width+d.left,d.top,-d.width,d.height),i.stroke(),i.fillStyle="rgba(0,0,0,0.7)",i.fill(),i.closePath(),i.beginPath(),i.strokeStyle=r,i.lineWidth=s,i.setLineDash([4]),i.strokeRect(d.left,d.top,d.width,d.height),i.setLineDash([]),n.drawHandles(i,t,l.handles,r),i.restore()}}}n.highlight=n.mouseButtonRectangleTool({createNewMeasurement:a,onImageRendered:s,pointNearTool:i,pointInsideRect:r,toolType:"highlight"},!0),n.highlightTouch=n.touchTool({createNewMeasurement:a,onImageRendered:s,pointNearTool:i,pointInsideRect:r,toolType:"highlight"},!0)}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t){"use strict";t.keyboardTool=function(o){var t={};return{activate:function(t){e(t).off("CornerstoneToolsKeyDown",o),e(t).on("CornerstoneToolsKeyDown",o)},disable:function(t){e(t).off("CornerstoneToolsKeyDown",o)},enable:function(t){e(t).off("CornerstoneToolsKeyDown",o)},deactivate:function(t){e(t).off("CornerstoneToolsKeyDown",o)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}}}($,cornerstone,cornerstoneTools),function(e,o,t,n){"use strict";function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,n,a){var r={start:o.pixelToCanvas(e,n.handles.start),end:o.pixelToCanvas(e,n.handles.end)};return t.lineSegment.distanceToPoint(r,a)<25}function i(e,a){var r=n.getToolState(e.currentTarget,"length");if(r){var i=a.canvasContext.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);for(var s=n.toolStyle.getToolWidth(),l=n.length.getConfiguration(),c=0;c<r.data.length;c++){i.save(),l&&l.shadow&&(i.shadowColor=l.shadowColor||"#000000",i.shadowOffsetX=l.shadowOffsetX||1,i.shadowOffsetY=l.shadowOffsetY||1);var u=r.data[c],d=n.toolColors.getColorIfActive(u.active),g=o.pixelToCanvas(a.element,u.handles.start),f=o.pixelToCanvas(a.element,u.handles.end);i.beginPath(),i.strokeStyle=d,i.lineWidth=s,i.moveTo(g.x,g.y),i.lineTo(f.x,f.y),i.stroke();var m={drawHandlesIfActive:l&&l.drawHandlesOnHover};n.drawHandles(i,a,u.handles,d,m),i.fillStyle=d;var h=(u.handles.end.x-u.handles.start.x)*(a.image.columnPixelSpacing||1),v=(u.handles.end.y-u.handles.start.y)*(a.image.rowPixelSpacing||1),T=Math.sqrt(h*h+v*v);u.length=T;var p=" mm";a.image.rowPixelSpacing&&a.image.columnPixelSpacing||(p=" pixels");var C=""+T.toFixed(2)+p;if(!u.handles.textBox.hasMoved){var x={x:Math.max(u.handles.start.x,u.handles.end.x)};x.x===u.handles.start.x?x.y=u.handles.start.y:x.y=u.handles.end.y,u.handles.textBox.x=x.x,u.handles.textBox.y=x.y}var M=o.pixelToCanvas(a.element,u.handles.textBox);M.x+=10;var y=n.drawTextBox(i,C,M.x,M.y,d,{centering:{x:!1,y:!0}});if(u.handles.textBox.boundingBox=y,u.handles.textBox.hasMoved){var w={start:{},end:{}},b=[g,f,{x:(g.x+f.x)/2,y:(g.y+f.y)/2}];w.end.x=M.x,w.end.y=M.y,w.start=t.point.findClosestPoint(b,w.end);var P=[{x:y.left+y.width/2,y:y.top},{x:y.left,y:y.top+y.height/2},{x:y.left+y.width/2,y:y.top+y.height},{x:y.left+y.width,y:y.top+y.height/2}];w.end=t.point.findClosestPoint(P,w.start),i.beginPath(),i.strokeStyle=d,i.lineWidth=s,i.setLineDash([2,3]),i.moveTo(w.start.x,w.start.y),i.lineTo(w.end.x,w.end.y),i.stroke()}i.restore()}}}n.length=n.mouseButtonTool({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:"length"}),n.lengthTouch=n.touchTool({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:"length"})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t){"use strict";var n,a={magnifySize:100,magnificationLevel:2};function r(o,t){e(t.element).off("CornerstoneToolsMouseDrag",c),e(t.element).off("CornerstoneToolsMouseUp",r),e(t.element).off("CornerstoneToolsMouseClick",r),i(t)}function i(o){e(o.element).find(".magnifyTool").hide(),document.body.style.cursor="default"}function s(o,n){if(t.isMouseButtonEnabled(n.which,o.data.mouseButtonMask))return e(n.element).on("CornerstoneToolsMouseDrag",n,c),e(n.element).on("CornerstoneToolsMouseUp",n,r),e(n.element).on("CornerstoneToolsMouseClick",n,r),u(n),!1}function l(o,t){e(t.element).off("CornerstoneToolsDragEnd",l),e(t.element).off("CornerstoneToolsTouchEnd",l),i(t)}function c(o,t){return u(t),!0===t.isTouchEvent&&(e(t.element).on("CornerstoneToolsDragEnd",l),e(t.element).on("CornerstoneToolsTouchEnd",l)),!1}function u(a){var r=e(a.element).find(".magnifyTool").get(0);r||d(a.element);var i=t.magnify.getConfiguration(),s=i.magnifySize,l=i.magnificationLevel,c=e(a.element).find("canvas").not(".magnifyTool").get(0);c.getContext("2d").setTransform(1,0,0,1,0,0);var u=r.getContext("2d");u.setTransform(1,0,0,1,0,0);var g=s/l,f=o.pixelToCanvas(a.element,a.currentPoints.image);!0===a.isTouchEvent&&(f.y-=1.25*g),f.x=Math.max(f.x,0),f.x=Math.min(f.x,c.width),f.y=Math.max(f.y,0),f.y=Math.min(f.y,c.height),u.clearRect(0,0,s,s),u.fillStyle="transparent",u.fillRect(0,0,s,s);var m={x:f.x-.5*g,y:f.y-.5*g};"Safari"===n&&(m.x=Math.max(m.x,0),m.y=Math.max(m.y,0)),m.x=Math.min(m.x,c.width),m.y=Math.min(m.y,c.height);var h={x:(c.width-m.x)*l,y:(c.height-m.y)*l};u.drawImage(c,m.x,m.y,c.width-m.x,c.height-m.y,0,0,h.x,h.y),r.style.top=f.y-.5*s+"px",r.style.left=f.x-.5*s+"px",r.style.display="block",document.body.style.cursor="none"}function d(o){if(0===e(o).find(".magnifyTool").length){var n=document.createElement("canvas");n.classList.add("magnifyTool");var a=t.magnify.getConfiguration();n.width=a.magnifySize,n.height=a.magnifySize,n.style.position="absolute",o.appendChild(n)}}function g(o){e(o).find(".magnifyTool").remove()}function f(o){e(o).off("CornerstoneToolsMouseDown",s),g(o)}t.magnify={enable:function(e){var o=t.magnify.getConfiguration(o);if(!n){var a=t.getBrowserInfo().split(" ");n=a[0]}d(e)},activate:function(o,t){var n={mouseButtonMask:t};e(o).off("CornerstoneToolsMouseDown",s),e(o).on("CornerstoneToolsMouseDown",n,s),d(o)},deactivate:f,disable:f,getConfiguration:function(){return a},setConfiguration:function(e){a=e}};var m={fireOnTouchStart:!0,activateCallback:d,disableCallback:g};t.magnifyTouchDrag=t.touchDragTool(c,m)}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.multiTouchDragTool=function(o,t){var n={},a="CornerstoneToolsMultiTouchDrag";return t&&!0===t.fireOnTouchStart&&(a+=" CornerstoneToolsMultiTouchStart"),{activate:function(n){e(n).off(a,o),t&&t.eventData?e(n).on(a,t.eventData,o):e(n).on(a,o),t&&t.activateCallback&&t.activateCallback(n)},disable:function(n){e(n).off(a,o),t&&t.disableCallback&&t.disableCallback(n)},enable:function(n){e(n).off(a,o),t&&t.enableCallback&&t.enableCallback(n)},deactivate:function(n){e(n).off(a,o),t&&t.deactivateCallback&&t.deactivateCallback(n)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.orientationMarkers=t.displayTool((function(e,n){var a=n.element,r=function(e){var n=o.getEnabledElement(e),a=t.metaData.get("imagePlane",n.image.imageId);if(a&&a.rowCosines&&a.columnCosines){var r=t.orientation.getOrientationString(a.rowCosines),i=t.orientation.getOrientationString(a.columnCosines),s=t.orientation.invertOrientationString(r);return{top:t.orientation.invertOrientationString(i),bottom:i,left:s,right:r}}}(a);if(r){var i=function(e){var t,n=o.getEnabledElement(e);t={x:n.image.width/2,y:5};var a=o.pixelToCanvas(e,t);t={x:n.image.width/2,y:n.image.height-5};var r=o.pixelToCanvas(e,t);t={x:5,y:n.image.height/2};var i=o.pixelToCanvas(e,t);return t={x:n.image.width-10,y:n.image.height/2},{top:a,bottom:r,left:i,right:o.pixelToCanvas(e,t)}}(a),s=n.canvasContext.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0);var l=t.toolColors.getToolColor(),c=s.measureText(r.top).width,u=s.measureText(r.left).width,d=s.measureText(r.right).width,g=s.measureText(r.bottom).width;t.drawTextBox(s,r.top,i.top.x-c/2,i.top.y,l),t.drawTextBox(s,r.left,i.left.x-u/2,i.left.y,l);var f=t.orientationMarkers.getConfiguration();f&&f.drawAllMarkers&&(t.drawTextBox(s,r.right,i.right.x-d/2,i.right.y,l),t.drawTextBox(s,r.bottom,i.bottom.x-g/2,i.bottom.y,l))}}))}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";function n(o,t){e(t.element).off("CornerstoneToolsMouseDrag",a),e(t.element).off("CornerstoneToolsMouseUp",n),e(t.element).off("CornerstoneToolsMouseClick",n)}function a(e,t){return t.viewport.translation.x+=t.deltaPoints.page.x/t.viewport.scale,t.viewport.translation.y+=t.deltaPoints.page.y/t.viewport.scale,o.setViewport(t.element,t.viewport),!1}t.pan=t.simpleMouseButtonTool((function(o,r){if(t.isMouseButtonEnabled(r.which,o.data.mouseButtonMask))return e(r.element).on("CornerstoneToolsMouseDrag",a),e(r.element).on("CornerstoneToolsMouseUp",n),e(r.element).on("CornerstoneToolsMouseClick",n),!1})),t.panTouchDrag=t.touchDragTool(a)}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.panMultiTouch=t.multiTouchDragTool((function(e,n){var a=t.panMultiTouch.getConfiguration();if(a&&a.testPointers(n))return n.viewport.translation.x+=n.deltaPoints.page.x/n.viewport.scale,n.viewport.translation.y+=n.deltaPoints.page.y/n.viewport.scale,o.setViewport(n.element,n.viewport),!1})),t.panMultiTouch.setConfiguration({testPointers:function(e){return e.numPointers>=2}})}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";function n(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function a(e,t,n){var a=o.pixelToCanvas(e,t.handles.end);return cornerstoneMath.point.distance(a,n)<5}function r(e,n){var a=t.getToolState(e.currentTarget,"probe");if(a){var r,i=n.canvasContext.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);for(var s=t.textStyle.getFont(),l=t.textStyle.getFontSize(),c=0;c<a.data.length;c++){i.save();var u=a.data[c];r=u.active?t.toolColors.getActiveColor():t.toolColors.getToolColor(),t.drawHandles(i,n,u.handles,r);var d,g,f,m=Math.round(u.handles.end.x),h=Math.round(u.handles.end.y);if(m<0||h<0||m>=n.image.columns||h>=n.image.rows)return;if(n.image.color)g=m+", "+h,f="R: "+(d=t.getRGBPixels(n.element,m,h,1,1))[0]+" G: "+d[1]+" B: "+d[2];else{var v=(d=o.getStoredPixels(n.element,m,h,1,1))[0],T=v*n.image.slope+n.image.intercept,p=t.calculateSUV(n.image,v);g=m+", "+h,f="SP: "+v+" MO: "+parseFloat(T.toFixed(3)),p&&(f+=" SUV: "+parseFloat(p.toFixed(3)))}var C={x:u.handles.end.x+3,y:u.handles.end.y-3},x=o.pixelToCanvas(n.element,C);i.font=s,i.fillStyle=r,t.drawTextBox(i,f,x.x,x.y+l+5,r),t.drawTextBox(i,g,x.x,x.y,r),i.restore()}}}t.probe=t.mouseButtonTool({createNewMeasurement:n,onImageRendered:r,pointNearTool:a,toolType:"probe"}),t.probeTouch=t.touchTool({createNewMeasurement:n,onImageRendered:r,pointNearTool:a,toolType:"probe"})}($,cornerstone,cornerstoneTools),function(e,o,t,n){"use strict";function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function r(e,n,a){var r=o.pixelToCanvas(e,n.handles.start),i=o.pixelToCanvas(e,n.handles.end),s={left:Math.min(r.x,i.x),top:Math.min(r.y,i.y),width:Math.abs(r.x-i.x),height:Math.abs(r.y-i.y)};return t.rect.distanceToPoint(s,a)<5}function i(e,o){for(var t=0,n=0,a=0,r=0,i=o.top;i<o.top+o.height;i++)for(var s=o.left;s<o.left+o.width;s++)t+=e[r],n+=e[r]*e[r],a++,r++;if(0===a)return{count:a,mean:0,variance:0,stdDev:0};var l=t/a,c=n/a-l*l;return{count:a,mean:l,variance:c,stdDev:Math.sqrt(c)}}function s(e,t){var a=n.getToolState(e.currentTarget,"rectangleRoi");if(void 0!==a){var r,s=t.canvasContext.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0);for(var l=n.toolStyle.getToolWidth(),c=n.textStyle.getFont(),u=n.textStyle.getFontSize(),d=n.rectangleRoi.getConfiguration(),g=0;g<a.data.length;g++){s.save();var f=a.data[g];d&&d.shadow&&(s.shadowColor=d.shadowColor||"#000000",s.shadowOffsetX=d.shadowOffsetX||1,s.shadowOffsetY=d.shadowOffsetY||1),r=f.active?n.toolColors.getActiveColor():n.toolColors.getToolColor();var m=o.pixelToCanvas(t.element,f.handles.start),h=o.pixelToCanvas(t.element,f.handles.end),v=Math.abs(m.x-h.x),T=Math.abs(m.y-h.y),p=Math.min(m.x,h.x),C=Math.min(m.y,h.y),x=(m.x+h.x)/2,M=(m.y+h.y)/2;s.beginPath(),s.strokeStyle=r,s.lineWidth=l,s.rect(p,C,v,T),s.stroke(),n.drawHandles(s,t,f.handles,r);var y=Math.abs(f.handles.start.x-f.handles.end.x),w=Math.abs(f.handles.start.y-f.handles.end.y),b=Math.min(f.handles.start.x,f.handles.end.x),P=Math.min(f.handles.start.y,f.handles.end.y),I=i(o.getPixels(t.element,b,P,y,w),{left:b,top:P,width:y,height:w}),S=y*t.image.columnPixelSpacing*(w*t.image.rowPixelSpacing),k="Area: "+S.toFixed(2)+" mm^2";s.font=c;var D=s.measureText(S),E=x<t.image.columns/2?x+v/2:x-v/2-D.width,A=M<t.image.rows/2?M+T/2:M-T/2;s.fillStyle=r,n.drawTextBox(s,"Mean: "+I.mean.toFixed(2),E,A-u-5,r),n.drawTextBox(s,"StdDev: "+I.stdDev.toFixed(2),E,A,r),n.drawTextBox(s,k,E,A+u+5,r),s.restore()}}}n.rectangleRoi=n.mouseButtonTool({createNewMeasurement:a,onImageRendered:s,pointNearTool:r,toolType:"rectangleRoi"}),n.rectangleRoiTouch=n.touchTool({createNewMeasurement:a,onImageRendered:s,pointNearTool:r,toolType:"rectangleRoi"})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t){"use strict";function n(e){var t=e.element.getBoundingClientRect(e.element),n=e.currentPoints.client.x,a=e.currentPoints.client.y,r=e.element.clientWidth,i=e.element.clientHeight,s={x:n-t.left-r/2,y:-1*(a-t.top-i/2)},l=-1*(Math.atan2(s.y,s.x)*(180/Math.PI))+90;e.viewport.rotation=l,o.setViewport(e.element,e.viewport)}function a(o,t){e(t.element).off("CornerstoneToolsMouseDrag",r),e(t.element).off("CornerstoneToolsMouseUp",a),e(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,n){return t.rotate.strategy(n),o.setViewport(n.element,n.viewport),!1}t.rotate=t.simpleMouseButtonTool((function(o,n){if(t.isMouseButtonEnabled(n.which,o.data.mouseButtonMask))return e(n.element).on("CornerstoneToolsMouseDrag",r),e(n.element).on("CornerstoneToolsMouseUp",a),e(n.element).on("CornerstoneToolsMouseClick",a),!1})),t.rotate.strategies={default:n,horizontal:function(e){e.viewport.rotation+=e.deltaPoints.page.x/e.viewport.scale,o.setViewport(e.element,e.viewport)},vertical:function(e){e.viewport.rotation+=e.deltaPoints.page.y/e.viewport.scale,o.setViewport(e.element,e.viewport)}},t.rotate.strategy=n,t.rotateTouchDrag=t.touchDragTool(r)}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";function n(e,t){return t.viewport.rotation+=t.rotation,o.setViewport(t.element,t.viewport),!1}t.rotateTouch={activate:function(o){e(o).off("CornerstoneToolsTouchRotate",n),e(o).on("CornerstoneToolsTouchRotate",n)},disable:function(o){e(o).off("CornerstoneToolsTouchRotate",n)}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.saveAs=function(o,t){var n=e(o).find("canvas").get(0),a=document.createElement("a");if(a.download=t,a.href=n.toDataURL(),document.createEvent){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(r)}else a.fireEvent&&a.fireEvent("onclick")}}($,cornerstone,cornerstoneTools),function(e,o,t,n){"use strict";var a="simpleAngle";function r(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function i(e,n,a){var r={start:o.pixelToCanvas(e,n.handles.start),end:o.pixelToCanvas(e,n.handles.middle)},i=t.lineSegment.distanceToPoint(r,a);return i<25||(r.start=o.pixelToCanvas(e,n.handles.middle),r.end=o.pixelToCanvas(e,n.handles.end),(i=t.lineSegment.distanceToPoint(r,a))<25)}function s(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function l(e,r){var i=n.getToolState(e.currentTarget,a);if(i){var l,c=r.enabledElement,u=r.canvasContext.canvas.getContext("2d");u.setTransform(1,0,0,1,0,0);for(var d=n.toolStyle.getToolWidth(),g=n.textStyle.getFont(),f=n.simpleAngle.getConfiguration(),m=0;m<i.data.length;m++){u.save(),f&&f.shadow&&(u.shadowColor=f.shadowColor||"#000000",u.shadowOffsetX=f.shadowOffsetX||1,u.shadowOffsetY=f.shadowOffsetY||1);var h=i.data[m];l=h.active?n.toolColors.getActiveColor():n.toolColors.getToolColor();var v=o.pixelToCanvas(r.element,h.handles.start),T=o.pixelToCanvas(r.element,h.handles.middle),p=o.pixelToCanvas(r.element,h.handles.end);u.beginPath(),u.strokeStyle=l,u.lineWidth=d,u.moveTo(v.x,v.y),u.lineTo(T.x,T.y),u.lineTo(p.x,p.y),u.stroke();var C={drawHandlesIfActive:f&&f.drawHandlesOnHover};n.drawHandles(u,r,h.handles,l,C),u.fillStyle=l;var x=r.image.columnPixelSpacing||1,M=r.image.rowPixelSpacing||1,y="";r.image.rowPixelSpacing&&r.image.columnPixelSpacing||(y=" (isotropic)");var w={x:(Math.ceil(h.handles.middle.x)-Math.ceil(h.handles.start.x))*x,y:(Math.ceil(h.handles.middle.y)-Math.ceil(h.handles.start.y))*M},b={x:(Math.ceil(h.handles.end.x)-Math.ceil(h.handles.middle.x))*x,y:(Math.ceil(h.handles.end.y)-Math.ceil(h.handles.middle.y))*M},P={x:(Math.ceil(h.handles.end.x)-Math.ceil(h.handles.start.x))*x,y:(Math.ceil(h.handles.end.y)-Math.ceil(h.handles.start.y))*M},I=s(w),S=s(b),k=s(P),D=Math.acos((Math.pow(I,2)+Math.pow(S,2)-Math.pow(k,2))/(2*I*S));D*=180/Math.PI;var E=n.roundToDecimal(D,2);if(E){var A,R=E.toString()+String.fromCharCode(parseInt("00B0",16))+y;if(h.handles.textBox.hasMoved)A=o.pixelToCanvas(r.element,h.handles.textBox);else{A={x:T.x,y:T.y},u.font=g;var H=u.measureText(R).width;T.x<v.x?A.x-=15+H+10:A.x+=15;var B=o.internal.getTransform(c);B.invert();var O=B.transformPoint(A.x,A.y);h.handles.textBox.x=O.x,h.handles.textBox.y=O.y}var N=n.drawTextBox(u,R,A.x,A.y,l,{centering:{x:!1,y:!0}});if(h.handles.textBox.boundingBox=N,h.handles.textBox.hasMoved){var L={start:{},end:{}},V=[v,p,T];L.end.x=A.x,L.end.y=A.y,L.start=t.point.findClosestPoint(V,L.end);var Y=[{x:N.left+N.width/2,y:N.top},{x:N.left,y:N.top+N.height/2},{x:N.left+N.width/2,y:N.top+N.height},{x:N.left+N.width,y:N.top+N.height/2}];L.end=t.point.findClosestPoint(Y,L.start),u.beginPath(),u.strokeStyle=l,u.lineWidth=d,u.setLineDash([2,3]),u.moveTo(L.start.x,L.start.y),u.lineTo(L.end.x,L.end.y),u.stroke()}}u.restore()}}}n.simpleAngle=n.mouseButtonTool({createNewMeasurement:r,addNewMeasurement:function(t){var i=r(t),s=t.element,l={mouseButtonMask:t.which};n.addToolState(s,a,i),e(s).off("CornerstoneToolsMouseMove",n.simpleAngle.mouseMoveCallback),e(s).off("CornerstoneToolsMouseDrag",n.simpleAngle.mouseMoveCallback),e(s).off("CornerstoneToolsMouseDown",n.simpleAngle.mouseDownCallback),e(s).off("CornerstoneToolsMouseDownActivate",n.simpleAngle.mouseDownActivateCallback),o.updateImage(s),n.moveNewHandle(t,a,i,i.handles.middle,(function(){if(i.active=!1,n.anyHandlesOutsideImage(t,i.handles))return n.removeToolState(s,a,i),e(s).on("CornerstoneToolsMouseMove",n.simpleAngle.mouseMoveCallback),e(s).on("CornerstoneToolsMouseDrag",n.simpleAngle.mouseMoveCallback),e(s).on("CornerstoneToolsMouseDown",l,n.simpleAngle.mouseDownCallback),e(s).on("CornerstoneToolsMouseDownActivate",l,n.simpleAngle.mouseDownActivateCallback),void o.updateImage(s);i.handles.end.active=!0,o.updateImage(s),n.moveNewHandle(t,a,i,i.handles.end,(function(){i.active=!1,n.anyHandlesOutsideImage(t,i.handles)&&n.removeToolState(s,a,i),e(s).on("CornerstoneToolsMouseMove",n.simpleAngle.mouseMoveCallback),e(s).on("CornerstoneToolsMouseDrag",n.simpleAngle.mouseMoveCallback),e(s).on("CornerstoneToolsMouseDown",l,n.simpleAngle.mouseDownCallback),e(s).on("CornerstoneToolsMouseDownActivate",l,n.simpleAngle.mouseDownActivateCallback),o.updateImage(s)}))}))},onImageRendered:l,pointNearTool:i,toolType:a}),n.simpleAngleTouch=n.touchTool({createNewMeasurement:r,addNewMeasurement:function(t){var i=r(t),s=t.element;n.addToolState(s,a,i),e(s).off("CornerstoneToolsTouchDrag",n.simpleAngleTouch.touchMoveCallback),e(s).off("CornerstoneToolsTouchStartActive",n.simpleAngleTouch.touchDownActivateCallback),e(s).off("CornerstoneToolsTouchStart",n.simpleAngleTouch.touchStartCallback),e(s).off("CornerstoneToolsTap",n.simpleAngleTouch.tapCallback),o.updateImage(s),n.moveNewHandleTouch(t,a,i,i.handles.middle,(function(){if(n.anyHandlesOutsideImage(t,i.handles))return n.removeToolState(s,a,i),e(s).on("CornerstoneToolsTouchDrag",n.simpleAngleTouch.touchMoveCallback),e(s).on("CornerstoneToolsTouchStart",n.simpleAngleTouch.touchStartCallback),e(s).on("CornerstoneToolsTouchStartActive",n.simpleAngleTouch.touchDownActivateCallback),e(s).on("CornerstoneToolsTap",n.simpleAngleTouch.tapCallback),void o.updateImage(s);n.moveNewHandleTouch(t,a,i,i.handles.end,(function(){n.anyHandlesOutsideImage(t,i.handles)&&(n.removeToolState(s,a,i),o.updateImage(s)),e(s).on("CornerstoneToolsTouchDrag",n.simpleAngleTouch.touchMoveCallback),e(s).on("CornerstoneToolsTouchStart",n.simpleAngleTouch.touchStartCallback),e(s).on("CornerstoneToolsTouchStartActive",n.simpleAngleTouch.touchDownActivateCallback),e(s).on("CornerstoneToolsTap",n.simpleAngleTouch.tapCallback)}))}))},onImageRendered:l,pointNearTool:i,toolType:a})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t){"use strict";var n="textMarker";function a(e){var o=t.textMarker.getConfiguration();if(o.current){var n={visible:!0,active:!0,text:o.current,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},a={left:0,top:0,width:e.image.width,height:e.image.height};if(cornerstoneMath.point.insideRect(n.handles.end,a)){var r=o.markers.indexOf(o.current);return o.ascending?(r+=1)>=o.markers.length&&(o.loop?r-=o.markers.length:r=-1):(r-=1)<0&&(o.loop?r+=o.markers.length:r=-1),o.current=o.markers[r],n}}}function r(e,o,n){if(o.handles.end.boundingBox){var a=cornerstoneMath.rect.distanceToPoint(o.handles.end.boundingBox,n),r=t.pointInsideBoundingBox(o.handles.end,n);return a<10||r}}function i(e,a){var r=t.getToolState(a.element,n);if(r){var i=a.canvasContext.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);for(var s=t.textMarker.getConfiguration(),l=0;l<r.data.length;l++){var c=r.data[l],u=t.toolColors.getToolColor();c.active&&(u=t.toolColors.getActiveColor()),i.save(),s&&s.shadow&&(i.shadowColor=s.shadowColor||"#000000",i.shadowOffsetX=s.shadowOffsetX||1,i.shadowOffsetY=s.shadowOffsetY||1),i.fillStyle=u;var d=i.measureText(c.text);c.textWidth=d.width+10;var g=o.pixelToCanvas(a.element,c.handles.end),f=t.drawTextBox(i,c.text,g.x,g.y-10,u,{centering:{x:!0,y:!0}});c.handles.end.boundingBox=f,i.restore()}}}t.textMarker=t.mouseButtonTool({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:n,mouseDoubleClickCallback:function(a,i){var s,l=i.element;function c(r,i){!0===i?t.removeToolState(l,n,s):s.text=r,s.active=!1,o.updateImage(l);var c={mouseButtonMask:a.data.mouseButtonMask};e(l).on("CornerstoneToolsMouseMove",c,t.textMarker.mouseMoveCallback),e(l).on("CornerstoneToolsMouseDown",c,t.textMarker.mouseDownCallback),e(l).on("CornerstoneToolsMouseDownActivate",c,t.textMarker.mouseDownActivateCallback),e(l).on("CornerstoneToolsMouseDoubleClick",c,t.textMarker.mouseDoubleClickCallback)}if(a.data&&a.data.mouseButtonMask&&!t.isMouseButtonEnabled(i.which,a.data.mouseButtonMask))return!1;var u=t.textMarker.getConfiguration(),d=i.currentPoints.canvas,g=t.getToolState(l,n);if(!g)return!1;for(var f=0;f<g.data.length;f++)if(r(0,s=g.data[f],d))return s.active=!0,o.updateImage(l),e(l).off("CornerstoneToolsMouseMove",t.textMarker.mouseMoveCallback),e(l).off("CornerstoneToolsMouseDown",t.textMarker.mouseDownCallback),e(l).off("CornerstoneToolsMouseDownActivate",t.textMarker.mouseDownActivateCallback),e(l).off("CornerstoneToolsMouseDoubleClick",t.textMarker.mouseDoubleClickCallback),u.changeTextCallback(s,i,c),a.stopImmediatePropagation(),!1;return!1}}),t.textMarkerTouch=t.touchTool({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:n,pressCallback:function(a,i){var s,l=i.element;function c(a,r){!0===r?t.removeToolState(l,n,s):s.text=a,s.active=!1,o.updateImage(l),e(l).on("CornerstoneToolsTouchDrag",t.textMarkerTouch.touchMoveCallback),e(l).on("CornerstoneToolsTouchStartActive",t.textMarkerTouch.touchDownActivateCallback),e(l).on("CornerstoneToolsTouchStart",t.textMarkerTouch.touchStartCallback),e(l).on("CornerstoneToolsTap",t.textMarkerTouch.tapCallback),e(l).on("CornerstoneToolsTouchPress",t.textMarkerTouch.pressCallback)}var u=t.textMarker.getConfiguration(),d=i.currentPoints.canvas,g=t.getToolState(l,n);if(!g)return!1;if(i.handlePressed)return i.handlePressed.active=!0,o.updateImage(l),e(l).off("CornerstoneToolsTouchDrag",t.textMarkerTouch.touchMoveCallback),e(l).off("CornerstoneToolsTouchStartActive",t.textMarkerTouch.touchDownActivateCallback),e(l).off("CornerstoneToolsTouchStart",t.textMarkerTouch.touchStartCallback),e(l).off("CornerstoneToolsTap",t.textMarkerTouch.tapCallback),e(l).off("CornerstoneToolsTouchPress",t.textMarkerTouch.pressCallback),u.changeTextCallback(i.handlePressed,i,c),a.stopImmediatePropagation(),!1;for(var f=0;f<g.data.length;f++)if(r(0,s=g.data[f],d))return s.active=!0,o.updateImage(l),e(l).off("CornerstoneToolsTouchDrag",t.textMarkerTouch.touchMoveCallback),e(l).off("CornerstoneToolsTouchStartActive",t.textMarkerTouch.touchDownActivateCallback),e(l).off("CornerstoneToolsTouchStart",t.textMarkerTouch.touchStartCallback),e(l).off("CornerstoneToolsTap",t.textMarkerTouch.tapCallback),e(l).off("CornerstoneToolsTouchPress",t.textMarkerTouch.pressCallback),u.changeTextCallback(s,i,c),a.stopImmediatePropagation(),!1;return!1}})}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";function n(o,t){e(t.element).off("CornerstoneToolsMouseDrag",r),e(t.element).off("CornerstoneToolsMouseUp",n),e(t.element).off("CornerstoneToolsMouseClick",n)}function a(e){var o=(e.image.maxPixelValue*e.image.slope+e.image.intercept-(e.image.minPixelValue*e.image.slope+e.image.intercept))/1024,t=e.deltaPoints.page.x*o,n=e.deltaPoints.page.y*o;e.viewport.voi.windowWidth+=t,e.viewport.voi.windowCenter+=n}function r(e,n){return t.wwwc.strategy(n),o.setViewport(n.element,n.viewport),!1}t.wwwc=t.simpleMouseButtonTool((function(o,a){if(t.isMouseButtonEnabled(a.which,o.data.mouseButtonMask))return e(a.element).on("CornerstoneToolsMouseDrag",r),e(a.element).on("CornerstoneToolsMouseUp",n),e(a.element).on("CornerstoneToolsMouseClick",n),!1})),t.wwwc.strategies={default:a},t.wwwc.strategy=a,t.wwwcTouchDrag=t.touchDragTool((function(e,n){e.stopImmediatePropagation();var a=n,r=(a.image.maxPixelValue*a.image.slope+a.image.intercept-(a.image.minPixelValue*a.image.slope+a.image.intercept))/1024,i=a.deltaPoints.page.x*r,s=a.deltaPoints.page.y*r,l=t.wwwc.getConfiguration();l.orientation?0===l.orientation?(a.viewport.voi.windowWidth+=i,a.viewport.voi.windowCenter+=s):(a.viewport.voi.windowWidth+=s,a.viewport.voi.windowCenter+=i):(a.viewport.voi.windowWidth+=i,a.viewport.voi.windowCenter+=s),o.setViewport(a.element,a.viewport)}))}($,cornerstone,cornerstoneTools),function(e,o,t,n){"use strict";var a="wwwcRegion",r={minWindowWidth:10};function i(o,t){e(t.element).off("CornerstoneToolsMouseMove",d),e(t.element).off("CornerstoneToolsMouseDrag",d),e(t.element).off("CornerstoneToolsMouseUp",i),e(t.element).off("CornerstoneToolsMouseClick",i);var r=n.getToolState(t.element,a);if(r&&r.data.length){var l={x:t.currentPoints.image.x,y:t.currentPoints.image.y};r.data[0].endPoint=l,s(t);var u={mouseButtonMask:t.which};e(t.element).on("CornerstoneToolsMouseDown",u,c)}}function s(e){var t=n.getToolState(e.element,a);if(t&&t.data.length){var r=t.data[0].startPoint,i=t.data[0].endPoint,s=Math.abs(r.x-i.x),l=Math.abs(r.y-i.y),c=Math.min(r.x,i.x),u=Math.min(r.y,i.y);c=Math.max(c,0),c=Math.min(c,e.image.width),u=Math.max(u,0),u=Math.min(u,e.image.height),s=Math.floor(Math.min(s,Math.abs(e.image.width-c))),l=Math.floor(Math.min(l,Math.abs(e.image.height-u)));var d=function(e,o,t){var n=e.length;if(n<2)return{min:o,max:t,mean:(o+t)/2};for(var a=t,r=o,i=0,s=0;s<n;s++){var l=e[s];a=Math.min(a,l),r=Math.max(r,l),i+=l}return{min:a,max:r,mean:i/n}}(n.getLuminance(e.element,c,u,s,l),e.image.minPixelValue,e.image.maxPixelValue),g=n.wwwcRegion.getConfiguration(),f=o.getViewport(e.element);void 0===g.minWindowWidth&&(g.minWindowWidth=10),f.voi.windowWidth=Math.max(Math.abs(d.max-d.min),g.minWindowWidth),f.voi.windowCenter=d.mean,o.setViewport(e.element,f),t.data=[],o.updateImage(e.element)}}function l(o,t){var n=t.element;e(n).off("CornerstoneToolsMouseMove"),e(n).off("CornerstoneToolsMouseDrag"),e(n).on("CornerstoneToolsMouseMove",d),e(n).on("CornerstoneToolsMouseDrag",d),e(n).on("CornerstoneToolsMouseClick",i),"CornerstoneToolsMouseDrag"===o.type&&e(n).on("CornerstoneToolsMouseUp",i)}function c(o,t){if(n.isMouseButtonEnabled(t.which,o.data.mouseButtonMask))return e(t.element).on("CornerstoneToolsMouseDrag",t,l),e(t.element).on("CornerstoneToolsMouseMove",t,l),e(t.element).on("CornerstoneToolsMouseUp",i),e(t.element).off("CornerstoneToolsMouseDown"),u(t),!1}function u(e){var o=n.getToolState(e.element,a);o&&o.data&&(o.data=[]);var t={startPoint:{x:e.currentPoints.image.x,y:e.currentPoints.image.y}};n.addToolState(e.element,a,t)}function d(e,t){var r=n.getToolState(t.element,a);if(void 0!==r&&r.data.length){var i={x:t.currentPoints.image.x,y:t.currentPoints.image.y};r.data[0].endPoint=i,o.updateImage(t.element)}}function g(t,r){var i=n.getToolState(r.element,a);if(i&&i.data.length){var s=i.data[0].startPoint,l=i.data[0].endPoint;if(s&&l){var c=e(r.element).find("canvas").get(0).getContext("2d");c.setTransform(1,0,0,1,0,0);var u=n.toolColors.getActiveColor(),d=o.pixelToCanvas(r.element,s),g=o.pixelToCanvas(r.element,l),f=Math.min(d.x,g.x),m=Math.min(d.y,g.y),h=Math.abs(d.x-g.x),v=Math.abs(d.y-g.y),T=n.toolStyle.getToolWidth(),p=n.wwwcRegion.getConfiguration();c.save(),p&&p.shadow&&(c.shadowColor=p.shadowColor||"#000000",c.shadowOffsetX=p.shadowOffsetX||1,c.shadowOffsetY=p.shadowOffsetY||1),c.beginPath(),c.strokeStyle=u,c.lineWidth=T,c.rect(f,m,h,v),c.stroke(),c.restore()}}}function f(t){e(t).off("CornerstoneToolsMouseDown",c),e(t).off("CornerstoneImageRendered",g),o.updateImage(t)}function m(o){e(o).off("CornerstoneToolsTouchDrag",d),e(o).off("CornerstoneToolsTouchStart",u),e(o).off("CornerstoneToolsDragEnd",s),e(o).off("CornerstoneImageRendered",g)}n.wwwcRegion={activate:function(t,r){var s={mouseButtonMask:r};if(!n.getToolState(t,a)){n.addToolState(t,a,[])}e(t).off("CornerstoneToolsMouseDown",c),e(t).off("CornerstoneToolsMouseUp",i),e(t).off("CornerstoneToolsMouseDrag",d),e(t).off("CornerstoneImageRendered",g),e(t).on("CornerstoneToolsMouseDown",s,c),e(t).on("CornerstoneImageRendered",g),o.updateImage(t)},deactivate:f,disable:f,setConfiguration:function(e){r=e},getConfiguration:function(){return r}},n.wwwcRegionTouch={activate:function(o){if(void 0===n.getToolState(o,a)){n.addToolState(o,a,[])}e(o).off("CornerstoneToolsTouchDrag",d),e(o).off("CornerstoneToolsTouchStart",u),e(o).off("CornerstoneToolsDragEnd",s),e(o).off("CornerstoneImageRendered",g),e(o).on("CornerstoneToolsTouchDrag",d),e(o).on("CornerstoneToolsTouchStart",u),e(o).on("CornerstoneToolsDragEnd",s),e(o).on("CornerstoneImageRendered",g)},deactivate:m,disable:m}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t){"use strict";var n;function a(e,o){var n=t.zoom.getConfiguration(),a=Math.log(e.scale)/Math.log(1.7)+o,r=Math.pow(1.7,a);return n.maxScale&&r>n.maxScale?e.scale=n.maxScale:n.minScale&&r<n.minScale?e.scale=n.minScale:e.scale=r,e}function r(e,o,t){return e.x=Math.max(e.x,0),e.y=Math.max(e.y,0),e.x=Math.min(e.x,o),e.y=Math.min(e.y,t),e}function i(e,o){if(0!==o.rotation){var t=o.rotation*Math.PI/180,n=Math.cos(t),a=Math.sin(t),r=e.x*n-e.y*a,i=e.x*a+e.y*n;e.x=r,e.y=i}return o.hflip&&(e.x*=-1),o.vflip&&(e.y*=-1),e}function s(e,t){var n=e.element,r=a(e.viewport,t);o.setViewport(n,r);var s=o.pageToPixel(n,e.startPoints.page.x,e.startPoints.page.y),l={x:e.startPoints.image.x-s.x,y:e.startPoints.image.y-s.y};l=i(l,r),r.translation.x-=l.x,r.translation.y-=l.y,o.setViewport(n,r)}function l(o,t){e(t.element).off("CornerstoneToolsMouseDrag",c),e(t.element).off("CornerstoneToolsMouseUp",l),e(t.element).off("CornerstoneToolsMouseClick",l)}function c(e,o){if(!o.deltaPoints.page.y)return!1;var n=o.deltaPoints.page.y/100;return t.zoom.strategy(o,n),!1}t.zoom=t.simpleMouseButtonTool((function(o,a){if(t.isMouseButtonEnabled(a.which,o.data.mouseButtonMask))return n=a.startPoints,e(a.element).on("CornerstoneToolsMouseDrag",c),e(a.element).on("CornerstoneToolsMouseUp",l),e(a.element).on("CornerstoneToolsMouseClick",l),!1})),t.zoom.strategies={default:s,translate:function(e,s){var l=e.element,c=e.image,u=a(e.viewport,s);o.setViewport(l,u);var d,g,f=t.zoom.getConfiguration();if(s<0){if(d={x:u.scale<3?u.translation.x/8:0,y:u.scale<3?u.translation.y/8:0},Math.abs(u.translation.x)<.01)u.translation.x=0,d.x=0;else if(Math.abs(u.translation.y)<.01)u.translation.y=0,d.y=0;else if(Math.abs(u.translation.x)<.01&&Math.abs(u.translation.y)<.01)return o.setViewport(l,u),!1}else{g=o.pageToPixel(l,n.page.x,n.page.y),f&&f.preventZoomOutsideImage&&(n.image=r(n.image,c.width,c.height),g=r(g,c.width,c.height));var m={x:c.width/2-n.image.x,y:c.height/2-n.image.y},h={x:u.translation.x-m.x,y:u.translation.y-m.y};if(d={x:h.x/8,y:h.y/8},Math.abs(h.x)<.01)u.translation.x=m.x,d.x=0;else if(Math.abs(h.y)<.01)u.translation.y=m.y,d.y=0;else if(Math.abs(h.x)<.01&&Math.abs(h.y)<.01)return o.setViewport(l,u),!1}if(!(d=i(d,u)).x&&!d.y)return!1;u.translation.x-=d.x,u.translation.y-=d.y,o.setViewport(l,u)}},t.zoom.strategy=s,t.zoomWheel=t.mouseWheelTool((function(e,n){var r=-n.direction/4,i=t.zoom.getConfiguration();i&&i.invert&&(r*=-1);var s=a(n.viewport,r);o.setViewport(n.element,s)})),t.zoomTouchPinch=t.touchPinchTool((function(e,n){var a=t.zoom.getConfiguration(),r=n.viewport,s=n.element;r.scale+=n.scaleChange*r.scale,a.maxScale&&r.scale>a.maxScale?r.scale=a.maxScale:a.minScale&&r.scale<a.minScale&&(r.scale=a.minScale),o.setViewport(s,r);var l=o.pageToPixel(s,n.startPoints.page.x,n.startPoints.page.y),c={x:n.startPoints.image.x-l.x,y:n.startPoints.image.y-l.y};c=i(c,r),r.translation.x-=c.x,r.translation.y-=c.y,o.setViewport(s,r)})),t.zoomTouchDrag=t.touchDragTool(c)}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";var n,a;function r(t){var r=t.currentTarget,i={event:window.event||t,element:r,viewport:o.getViewport(r),image:o.getEnabledElement(r).image,currentPoints:{page:{x:n,y:a},image:o.pageToPixel(r,n,a)},keyCode:t.keyCode,which:t.which};i.currentPoints.canvas=o.pixelToCanvas(r,i.currentPoints.image);e(r).trigger({keydown:"CornerstoneToolsKeyDown",keypress:"CornerstoneToolsKeyPress",keyup:"CornerstoneToolsKeyUp"}[t.type],i)}function i(e){n=e.pageX||e.originalEvent.pageX,a=e.pageY||e.originalEvent.pageY}function s(o){e(o).off("keydown keypress keyup",r),e(o).off("mousemove",i)}t.keyboardInput={enable:function(o){s(o),e(o).on("keydown keypress keyup",r),e(o).on("mousemove",i)},disable:s}}($,cornerstone,cornerstoneTools),function(e){"use strict";var o,t,n=0,a=1;function r(e,n){var a=Date.now();if(e!==o){if(a-t<=2e3)return n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!1;o=e}t=a}var i=r.bind(null,n),s=r.bind(null,a);function l(e,o,t){var n=t?i:s;o.forEach((function(o){e.addEventListener(o,n,!0)}))}function c(e,o,t){var n=t?i:s;o.forEach((function(o){e.removeEventListener(o,n,!0)}))}var u=["mousedown","mouseup"],d=["touchstart","touchend"];function g(e){c(e,u,n),c(e,d,a)}e.preventGhostClick={enable:function(e){g(e),l(e,u,n),l(e,d,a)},disable:g}}(cornerstoneTools),function(e,o,t,n){"use strict";n.anyHandlesOutsideImage=function(e,o){var n=e.image,a={left:0,top:0,width:n.width,height:n.height},r=!1;return Object.keys(o).forEach((function(e){var n=o[e];!0!==n.allowedOutsideImage&&!1===t.point.insideRect(n,a)&&(r=!0)})),r}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o){"use strict";o.drawHandles=function(t,n,a,r,i){t.strokeStyle=r,Object.keys(a).forEach((function(r){var s=a[r];if(!0!==s.drawnIndependently&&(!i||!0!==i.drawHandlesIfActive||s.active)){t.beginPath(),s.active?t.lineWidth=o.toolStyle.getActiveWidth():t.lineWidth=o.toolStyle.getToolWidth();var l=e.pixelToCanvas(n.element,s);t.arc(l.x,l.y,6,0,2*Math.PI),i&&i.fill&&(t.fillStyle=i.fill,t.fill()),t.stroke()}}))}}(cornerstone,cornerstoneTools),function(e,o,t,n){"use strict";n.getHandleNearImagePoint=function(e,a,r,i){var s;if(a)return Object.keys(a).forEach((function(l){var c=a[l];if(c.hasOwnProperty("pointNearHandle")){if(c.pointNearHandle(e,c,r))return void(s=c)}else if(!0===c.hasBoundingBox){if(n.pointInsideBoundingBox(c,r))return void(s=c)}else{var u=o.pixelToCanvas(e,c);if(t.point.distance(u,r)<=i)return void(s=c)}})),s}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t,n){"use strict";n.handleActivator=function(e,o,t,a){a||(a=6);var r=function(e){var o;return Object.keys(e).forEach((function(t){var n=e[t];!0!==n.active||(o=n)})),o}(o),i=n.getHandleNearImagePoint(e,o,t,a);return r!==i&&(void 0!==i&&(i.active=!0),void 0!==r&&(r.active=!1),!0)}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t,n){"use strict";n.moveAllHandles=function(t,a,r,i,s,l){var c=t.element;function u(t,n){a.active=!0,Object.keys(a.handles).forEach((function(e){var o=a.handles[e];!0!==o.movesIndependently&&(o.x+=n.deltaPoints.image.x,o.y+=n.deltaPoints.image.y,!0===s.preventHandleOutsideImage&&(o.x=Math.max(o.x,0),o.x=Math.min(o.x,n.image.width),o.y=Math.max(o.y,0),o.y=Math.min(o.y,n.image.height)))})),o.updateImage(c);var r={toolType:i,element:c,measurementData:a};return e(c).trigger("CornerstoneToolsMeasurementModified",r),!1}function d(t,r){a.invalidated=!0,e(c).off("CornerstoneToolsMouseDrag",u),e(c).off("CornerstoneToolsMouseUp",d),e(c).off("CornerstoneToolsMouseClick",d),!0===s.deleteIfHandleOutsideImage&&n.anyHandlesOutsideImage(r,a.handles)&&n.removeToolState(c,i,a),o.updateImage(c),"function"==typeof l&&l()}return e(c).on("CornerstoneToolsMouseDrag",u),e(c).on("CornerstoneToolsMouseUp",d),e(c).on("CornerstoneToolsMouseClick",d),!0}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t){"use strict";t.moveHandle=function(t,n,a,r,i,s){var l=t.element,c=r.x-t.currentPoints.image.x,u=r.y-t.currentPoints.image.y;function d(t,i){!1===r.hasMoved&&(r.hasMoved=!0),r.active=!0,r.x=i.currentPoints.image.x+c,r.y=i.currentPoints.image.y+u,s&&(r.x=Math.max(r.x,0),r.x=Math.min(r.x,i.image.width),r.y=Math.max(r.y,0),r.y=Math.min(r.y,i.image.height)),o.updateImage(l);var d={toolType:n,element:l,measurementData:a};e(l).trigger("CornerstoneToolsMeasurementModified",d)}function g(){r.active=!1,e(l).off("CornerstoneToolsMouseDrag",d),e(l).off("CornerstoneToolsMouseUp",g),e(l).off("CornerstoneToolsMouseClick",g),o.updateImage(l),"function"==typeof i&&i()}e(l).on("CornerstoneToolsMouseDrag",d),e(l).on("CornerstoneToolsMouseUp",g),e(l).on("CornerstoneToolsMouseClick",g)}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.moveNewHandle=function(t,n,a,r,i,s){var l=t.element;function c(t,i){r.active=!0,r.x=i.currentPoints.image.x,r.y=i.currentPoints.image.y,s&&(r.x=Math.max(r.x,0),r.x=Math.min(r.x,i.image.width),r.y=Math.max(r.y,0),r.y=Math.min(r.y,i.image.height)),o.updateImage(l);var c={toolType:n,element:l,measurementData:a};e(l).trigger("CornerstoneToolsMeasurementModified",c)}function u(o){e(l).off("CornerstoneToolsMouseMove"),e(l).off("CornerstoneToolsMouseDrag"),e(l).on("CornerstoneToolsMouseMove",c),e(l).on("CornerstoneToolsMouseDrag",c),e(l).on("CornerstoneToolsMouseClick",f),"CornerstoneToolsMouseDrag"===o.type&&e(l).on("CornerstoneToolsMouseUp",f)}function d(e,o){o.measurementData===a&&f()}function g(t,a){a.toolType===n&&(e(l).off("CornerstoneToolsMouseMove",c),e(l).off("CornerstoneToolsMouseDrag",c),e(l).off("CornerstoneToolsMouseClick",f),e(l).off("CornerstoneToolsMouseUp",f),e(l).off("CornerstoneToolsMeasurementRemoved",d),e(l).off("CornerstoneToolsToolDeactivated",g),r.active=!1,o.updateImage(l))}function f(){e(l).off("CornerstoneToolsMouseMove",c),e(l).off("CornerstoneToolsMouseDrag",c),e(l).off("CornerstoneToolsMouseClick",f),e(l).off("CornerstoneToolsMouseUp",f),e(l).off("CornerstoneToolsMeasurementRemoved",d),e(l).off("CornerstoneToolsToolDeactivated",g),r.active=!1,o.updateImage(l),"function"==typeof i&&i()}e(l).on("CornerstoneToolsMouseDrag",u),e(l).on("CornerstoneToolsMouseMove",u),e(l).on("CornerstoneToolsMeasurementRemoved",d),e(l).on("CornerstoneToolsToolDeactivated",g)}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.moveNewHandleTouch=function(t,n,a,r,i,s){var l=t.element,c=o.pageToPixel(l,t.currentPoints.page.x,t.currentPoints.page.y+50),u=r.x-c.x,d=r.y-c.y;function g(t,i){r.x=i.currentPoints.image.x+u,r.y=i.currentPoints.image.y+d,s&&(r.x=Math.max(r.x,0),r.x=Math.min(r.x,i.image.width),r.y=Math.max(r.y,0),r.y=Math.min(r.y,i.image.height)),o.updateImage(l);var c={toolType:n,element:l,measurementData:a};e(l).trigger("CornerstoneToolsMeasurementModified",c)}function f(t,n){if(e(l).off("CornerstoneToolsTouchDrag",g),e(l).off("CornerstoneToolsTouchPinch",f),e(l).off("CornerstoneToolsTouchEnd",f),e(l).off("CornerstoneToolsTap",f),e(l).off("CornerstoneToolsTouchStart",m),e(l).off("CornerstoneToolsToolDeactivated",h),"CornerstoneToolsTouchPinch"===t.type||"CornerstoneToolsTouchPress"===t.type)return r.active=!1,o.updateImage(l),void i();r.active=!1,a.active=!1,r.x=n.currentPoints.image.x+u,r.y=n.currentPoints.image.y+d,s&&(r.x=Math.max(r.x,0),r.x=Math.min(r.x,n.image.width),r.y=Math.max(r.y,0),r.y=Math.min(r.y,n.image.height)),o.updateImage(l),"function"==typeof i&&i()}function m(e){return e.stopImmediatePropagation(),!1}function h(){e(l).off("CornerstoneToolsTouchDrag",g),e(l).off("CornerstoneToolsTouchPinch",f),e(l).off("CornerstoneToolsTouchEnd",f),e(l).off("CornerstoneToolsTap",f),e(l).off("CornerstoneToolsTouchStart",m),e(l).off("CornerstoneToolsToolDeactivated",h),r.active=!1,a.active=!1,r.x=t.currentPoints.image.x+u,r.y=t.currentPoints.image.y+d,s&&(r.x=Math.max(r.x,0),r.x=Math.min(r.x,t.image.width),r.y=Math.max(r.y,0),r.y=Math.min(r.y,t.image.height)),o.updateImage(l)}r.active=!0,a.active=!0,e(l).on("CornerstoneToolsTouchDrag",g),e(l).on("CornerstoneToolsTouchPinch",f),e(l).on("CornerstoneToolsTouchEnd",f),e(l).on("CornerstoneToolsTap",f),e(l).on("CornerstoneToolsTouchStart",m),e(l).on("CornerstoneToolsToolDeactivated",h)}}($,cornerstone,cornerstoneTools),function(e,o,t,n){"use strict";n.touchMoveAllHandles=function(t,a,r,i,s,l){var c=t.element;function u(t,n){a.active=!0,Object.keys(a.handles).forEach((function(e){var o=a.handles[e];!0!==o.movesIndependently&&(o.x+=n.deltaPoints.image.x,o.y+=n.deltaPoints.image.y)})),o.updateImage(c);var r={toolType:i,element:c,measurementData:a};return e(c).trigger("CornerstoneToolsMeasurementModified",r),!1}function d(t,r){a.active=!1,a.invalidated=!1,e(c).off("CornerstoneToolsTouchDrag",u),e(c).off("CornerstoneToolsTouchPinch",d),e(c).off("CornerstoneToolsTouchPress",d),e(c).off("CornerstoneToolsTouchEnd",d),e(c).off("CornerstoneToolsDragEnd",d),e(c).off("CornerstoneToolsTap",d),!0===s&&n.anyHandlesOutsideImage(r,a.handles)&&n.toolState.removeToolState(c,i,a),o.updateImage(c),"function"==typeof l&&l(t,r)}return e(c).on("CornerstoneToolsTouchDrag",u),e(c).on("CornerstoneToolsTouchPinch",d),e(c).on("CornerstoneToolsTouchPress",d),e(c).on("CornerstoneToolsTouchEnd",d),e(c).on("CornerstoneToolsDragEnd",d),e(c).on("CornerstoneToolsTap",d),!0}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,o,t){"use strict";var n={value:!1},a=["CornerstoneToolsTouchEnd","CornerstoneToolsDragEnd","CornerstoneToolsTouchPinch","CornerstoneToolsTouchPress","CornerstoneToolsTap"].join(" ");t.touchMoveHandle=function(r,i,s,l,c){n.value=!0;var u=r.element,d=o.getEnabledElement(u),g=((new Date).getTime(),{x:r.currentPoints.page.x,y:r.currentPoints.page.y+-57}),f=o.pageToPixel(u,g.x,g.y);function m(t,a){console.log("touchMoveHandle touchDragCallback: "+t.type),n.value=!1,!1===l.hasMoved&&(l.hasMoved=!0),l.active=!0;var r=a.currentPoints,c={x:r.page.x,y:r.page.y+-57};f=o.pageToPixel(u,c.x,c.y),l.x=f.x,l.y=f.y,o.updateImage(u);var d={toolType:i,element:u,measurementData:s};e(u).trigger("CornerstoneToolsMeasurementModified",d)}e(u).on("CornerstoneToolsTouchDrag",m),e(u).on(a,(function t(i,d){console.log("touchMoveHandle touchEndCallback: "+i.type),n.value=!1,l.active=!1,e(u).off("CornerstoneToolsTouchDrag",m),e(u).off(a,t),o.updateImage(u),"CornerstoneToolsTouchPress"===i.type&&(d.handlePressed=s,l.x=r.currentPoints.image.x,l.y=r.currentPoints.image.y),"function"==typeof c&&c(i,d)})),function e(n,a,r,i,s){if(r.value){var l=(new Date).getTime(),c=Math.abs(a.y-s.y),u=c/10;if(console.log("distanceRemaining: "+c),c<1)return a.y=s.y,void(r.value=!1);a.y>s.y?a.y-=u:a.y<s.y&&(a.y+=u),o.updateImage(i.element),t.requestAnimFrame((function(){e(l,a,r,i,s)}))}}(0,l,n,d,f)}}($,cornerstone,cornerstoneTools),function(e,o){"use strict";o.LineSampleMeasurement=function(){var o=this;o.samples=[],this.set=function(t){o.samples=t,e(o).trigger("CornerstoneLineSampleUpdated")}}}($,cornerstoneTools),function(e,o){"use strict";o.MeasurementManager=new function(){var o=this;o.measurements=[],this.add=function(t){var n={index:o.measurements.push(t),measurement:t};e(o).trigger("CornerstoneMeasurementAdded",n)},this.remove=function(t){var n=o.measurements[t];o.measurements.splice(t,1);var a={index:t,measurement:n};e(o).trigger("CornerstoneMeasurementRemoved",a)}}}($,cornerstoneTools),function(e,o,t){"use strict";var n=[];t.metaData={addProvider:function(e){n.push(e)},removeProvider:function(e){var o=n.indexOf(e);-1!==o&&n.splice(o,1)},get:function(o,t){var a;return e.each(n,(function(e,n){if(void 0!==(a=n(o,t)))return!0})),a}}}($,cornerstone,cornerstoneTools),function(e,o){"use strict";o.orientation.getOrientationString=function(o){for(var t="",n=o.x<0?"R":"L",a=o.y<0?"A":"P",r=o.z<0?"F":"H",i=new e.Vector3(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z)),s=0;s<3;s++)if(i.x>1e-4&&i.x>i.y&&i.x>i.z)t+=n,i.x=0;else if(i.y>1e-4&&i.y>i.x&&i.y>i.z)t+=a,i.y=0;else{if(!(i.z>1e-4&&i.z>i.x&&i.z>i.y))break;t+=r,i.z=0}return t}}(cornerstoneMath,cornerstoneTools),function(e){"use strict";e.orientation.invertOrientationString=function(e){var o=e.replace("H","f");return o=(o=(o=(o=(o=(o=o.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}}(cornerstoneTools),function(e){"use strict";e.referenceLines.calculateReferenceLine=function(o,t){var n=e.planePlaneIntersection(o,t);if(n)return{start:e.projectPatientPointToImagePlane(n.start,o),end:e.projectPatientPointToImagePlane(n.end,o)}}}(cornerstoneTools),function(e,o,t){"use strict";function n(n,a){var r=t.getToolState(n.currentTarget,"referenceLines");if(void 0!==r){var i=r.data[0].synchronizationContext.getSourceElements(),s=r.data[0].renderer,l=a.canvasContext.canvas.getContext("2d");o.setToPixelCoordinateSystem(a.enabledElement,l),e.each(i,(function(e,o){o!==n.currentTarget&&s(l,a,n.currentTarget,o)}))}}t.referenceLines.tool={enable:function(a,r,i){i=i||t.referenceLines.renderActiveReferenceLine,t.addToolState(a,"referenceLines",{synchronizationContext:r,renderer:i}),e(a).on("CornerstoneImageRendered",n),o.updateImage(a)},disable:function(t){e(t).off("CornerstoneImageRendered",n),o.updateImage(t)}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.referenceLines.renderActiveReferenceLine=function(e,n,a,r){var i=o.getEnabledElement(a).image,s=o.getEnabledElement(r).image;if(i&&s){var l=t.metaData.get("imagePlane",i.imageId),c=t.metaData.get("imagePlane",s.imageId);if(l&&c&&l.frameOfReferenceUID===c.frameOfReferenceUID){var u=l.rowCosines.clone().cross(l.columnCosines),d=c.rowCosines.clone().cross(c.columnCosines),g=u.angleTo(d);if(!((g=Math.abs(g))<.5)){var f=t.referenceLines.calculateReferenceLine(l,c);if(f){var m=o.pixelToCanvas(n.element,f.start),h=o.pixelToCanvas(n.element,f.end),v=t.toolColors.getActiveColor(),T=t.toolStyle.getToolWidth();e.setTransform(1,0,0,1,0,0),e.save(),e.beginPath(),e.strokeStyle=v,e.lineWidth=T,e.moveTo(m.x,m.y),e.lineTo(h.x,h.y),e.stroke(),e.restore()}}}}}}($,cornerstone,cornerstoneTools),function(e,o){"use strict";var t={interaction:[],thumbnail:[],prefetch:[]},n={interaction:0,thumbnail:0,prefetch:0},a={interaction:6,thumbnail:6,prefetch:5},r=!1;o.requestPoolManager=function(){function i(){r&&setTimeout((function(){var e=l();e&&s(e)}),20)}function s(o){var t=o.type;n[t]++,r=!0;var a=o.imageId,s=o.doneCallback,l=o.failCallback,c=e.imageCache.getImagePromise(a);c?c.then((function(e){n[t]--,s(e),i()}),(function(e){n[t]--,l(e),i()})):(!0===o.preventCache?e.loadImage(a):e.loadAndCacheImage(a)).then((function(e){n[t]--,s(e),i()}),(function(e){n[t]--,l(e),i()}))}function l(){return t.interaction.length&&n.interaction<a.interaction?t.interaction.shift():t.thumbnail.length&&n.thumbnail<a.thumbnail?t.thumbnail.shift():t.prefetch.length&&n.prefetch<a.prefetch?t.prefetch.shift():(t.interaction.length||t.thumbnail.length||t.prefetch.length||(r=!1),!1)}return{addRequest:function(o,n,a,r,i,s){if(!t.hasOwnProperty(a))throw"Request type must be one of interaction, thumbnail, or prefetch";if(o&&n){var l={type:a,imageId:n,preventCache:r,doneCallback:i,failCallback:s},c=e.imageCache.getImagePromise(n);c?c.then((function(e){i(e)}),(function(e){s(e)})):(t[a].push(l),"interaction"===a&&o)}},clearRequestStack:function(e){if(!t.hasOwnProperty(e))throw"Request type must be one of interaction, thumbnail, or prefetch";t[e]=[]},startGrabbing:function(){if(!r){var e=o.getMaxSimultaneousRequests();a={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=0;t<e;t++){var n=l();n&&s(n)}}},getRequestPool:function(){return t}}}()}(cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.playClip=function(n,a){if(void 0===n)throw"playClip: element must not be undefined";var r=t.getToolState(n,"stack");if(r&&r.data&&r.data.length){var i,s=r.data[0],l=t.getToolState(n,"playClip");l&&l.data&&l.data.length?i=l.data[0]:(i={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,loop:!0},t.addToolState(n,"playClip",i)),a&&(i.framesPerSecond=a),void 0===i.intervalId&&(i.intervalId=setInterval((function(){var a=s.currentImageIdIndex;if(i.framesPerSecond>0?a++:a--,!i.loop&&(a>=s.imageIds.length||a<0)){var r={element:n},l=e.Event("CornerstoneToolsClipStopped",r);return e(n).trigger(l,r),clearInterval(i.intervalId),void(i.intervalId=void 0)}if(a>=s.imageIds.length&&(a=0),a<0&&(a=s.imageIds.length-1),a!==s.currentImageIdIndex){var c=t.loadHandlerManager.getStartLoadHandler(),u=t.loadHandlerManager.getEndLoadHandler(),d=t.loadHandlerManager.getErrorLoadingHandler();c&&c(n);var g=o.getViewport(n);(!0===s.preventCache?o.loadImage(s.imageIds[a]):o.loadAndCacheImage(s.imageIds[a])).then((function(e){s.currentImageIdIndex=a,o.displayImage(n,e,g),u&&u(n)}),(function(e){var o=s.imageIds[a];d&&d(n,o,e)}))}}),1e3/Math.abs(i.framesPerSecond)))}},t.stopClip=function(e){var o=t.getToolState(e,"playClip");if(o&&o.data&&o.data.length){var n=o.data[0];clearInterval(n.intervalId),n.intervalId=void 0}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.scrollIndicator=t.displayTool((function(e,o){var n=o.element,a=o.enabledElement.canvas.width,r=o.enabledElement.canvas.height;if(!a||!r)return!1;var i=o.enabledElement.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),i.save();var s=t.scrollIndicator.getConfiguration();i.fillStyle=s.backgroundColor,i.fillRect(0,r-6,a,6);var l=t.getToolState(n,"stack");if(l&&l.data&&l.data.length){var c=l.data[0].imageIds,u=l.data[0].currentImageIdIndex,d=a/c.length,g=d*u;i.fillStyle=s.fillColor,i.fillRect(g,r-6,d,6),i.restore()}})),t.scrollIndicator.setConfiguration({backgroundColor:"rgb(19, 63, 141)",fillColor:"white"})}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";var n,a="stackPrefetch",r={};function i(e,o){return e-o}function s(e,o){e=Math.round(e)||0;var t=[],n=(o=Math.round(o)||0)-e+1;if(n<=0)return t;for(;n--;)t[n]=o--;return t}var l=function(e){return Math.max.apply(null,e)},c=function(e){return Math.min.apply(null,e)};function u(e){var n=t.getToolState(e,"stack");if(n&&n.data&&n.data.length){var r=n.data[0],s=t.getToolState(e,a);if(s){var u=s.data[0];if(u&&u.indicesToRequest&&u.indicesToRequest.length||(u.enabled=!1),!1!==u.enabled)if(s.data[0].indicesToRequest.sort(i),u.indicesToRequest.slice().forEach((function(e){var t=r.imageIds[e];if(t){var n=o.imageCache.getImagePromise(t);n&&"resolved"===n.state()&&y(e)}})),u.indicesToRequest.length){var d=t.requestPoolManager;d.clearRequestStack("prefetch");for(var g,f,m,h,v,T,p=(g=u.indicesToRequest,f=r.currentImageIdIndex,m=[],h=[],g.forEach((function(e){e<f?m.push(e):e>f&&h.push(e)})),{low:g.indexOf(l(m)),high:g.indexOf(c(h))}),C=t.loadHandlerManager.getErrorLoadingHandler(),x=p.low,M=p.high;x>0||M<u.indicesToRequest.length;)x>=0&&(T=u.indicesToRequest[x--],v=r.imageIds[T],d.addRequest(e,v,"prefetch",!1,w,b)),M<u.indicesToRequest.length&&(T=u.indicesToRequest[M++],v=r.imageIds[T],d.addRequest(e,v,"prefetch",!1,w,b));d.startGrabbing()}}}function y(e){var o=u.indicesToRequest.indexOf(e);o>-1&&u.indicesToRequest.splice(o,1)}function w(e){y(r.imageIds.indexOf(e.imageId))}function b(o){console.log("prefetch errored: "+o),C&&C(e,v,o,"stackPrefetch")}}function d(e){var o=e.data.element,n=t.getToolState(o,a);n&&n.data&&n.data.length&&t.requestPoolManager.clearRequestStack("prefetch")}function g(e,o){var n=e.data.element,r=t.getToolState(n,"stack");if(r&&r.data&&r.data.length){var i=r.data[0].imageIds.indexOf(o.imageId);if(!(i<0)){var s=t.getToolState(n,a);s&&s.data&&s.data.length&&s.data[0].indicesToRequest.push(i)}}}function f(e){clearTimeout(n),n=setTimeout((function(){u(e.target)}),void 0)}t.stackPrefetch={enable:function(n){t.getToolState(n,a).data=[];var r=t.getToolState(n,"stack");if(r&&r.data&&r.data.length){var i=r.data[0];if(!0!==i.preventCache){var l={indicesToRequest:s(0,i.imageIds.length-1),enabled:!0,direction:1},c=l.indicesToRequest.indexOf(i.currentImageIdIndex);l.indicesToRequest.splice(c,1),t.addToolState(n,a,l),u(n),e(n).off("CornerstoneNewImage",f),e(n).on("CornerstoneNewImage",f),e(o).off("CornerstoneImageCacheFull",d),e(o).on("CornerstoneImageCacheFull",{element:n},d),e(o).off("CornerstoneImageCachePromiseRemoved",g),e(o).on("CornerstoneImageCachePromiseRemoved",{element:n},g)}else console.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(r){clearTimeout(n),e(r).off("CornerstoneNewImage",f),e(o).off("CornerstoneImageCacheFull",d),e(o).off("CornerstoneImageCachePromiseRemoved",g);var i=t.getToolState(r,a);i&&i.data.length&&(i.data[0].enabled=!1,t.requestPoolManager.clearRequestStack("prefetch"))},getConfiguration:function(){return r},setConfiguration:function(e){r=e}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";function n(o,t){e(t.element).off("CornerstoneToolsMouseDrag",a),e(t.element).off("CornerstoneToolsMouseUp",n),e(t.element).off("CornerstoneToolsMouseClick",n)}function a(o,n){var a=n.element,r=t.getToolState(a,"stack");if(r&&r.data&&r.data.length){var i=r.data[0],s=t.stackScroll.getConfiguration(),l=e(a).height()/Math.max(i.imageIds.length,8);if(s&&s.stackScrollSpeed&&(l=s.stackScrollSpeed),o.data.deltaY=o.data.deltaY||0,o.data.deltaY+=n.deltaPoints.page.y,Math.abs(o.data.deltaY)>=l){var c=o.data.deltaY/l,u=Math.round(c),d=o.data.deltaY%l;o.data.deltaY=d,t.scroll(a,u)}return!1}}t.stackScroll=t.simpleMouseButtonTool((function(o,r){if(t.isMouseButtonEnabled(r.which,o.data.mouseButtonMask)){return e(r.element).on("CornerstoneToolsMouseDrag",{deltaY:0},a),e(r.element).on("CornerstoneToolsMouseUp",n),e(r.element).on("CornerstoneToolsMouseClick",n),o.stopImmediatePropagation(),!1}})),t.stackScrollWheel=t.mouseWheelTool((function(e,o){var n=-o.direction;t.scroll(o.element,n)}));var r={eventData:{deltaY:0}};t.stackScrollTouchDrag=t.touchDragTool(a,r);t.stackScrollMultiTouch=t.multiTouchDragTool((function(e,o){var n=t.stackScrollMultiTouch.getConfiguration();n&&n.testPointers(o)&&a(e,o)}),r),t.stackScrollMultiTouch.setConfiguration({testPointers:function(e){return e.numPointers>=3}})}($,cornerstone,cornerstoneTools),function(e){"use strict";var o=38,t=40;e.stackScrollKeyboard=e.keyboardTool((function(n,a){var r=a.keyCode;if(r===o||r===t){var i=1;r===t&&(i=-1),e.scroll(a.element,i)}}))}(cornerstoneTools),function(e,o,t){"use strict";t.appState={save:function(e){var n={imageIdToolState:t.globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return e.forEach((function(e){var a=t.getElementToolStateManager(e);a!==t.globalImageIdSpecificToolStateManager&&(n.elementToolState[e.id]=a.saveToolState(),n.elementViewport[e.id]=o.getViewport(e))})),n},restore:function(e){if(e.hasOwnProperty("imageIdToolState")&&e.hasOwnProperty("elementToolState")&&e.hasOwnProperty("elementViewport"))return t.globalImageIdSpecificToolStateManager.restoreToolState(e.imageIdToolState),Object.keys(e.elementViewport).forEach((function(n){var a=document.getElementById(n);if(a&&e.elementToolState.hasOwnProperty(n)){var r=t.getElementToolStateManager(a);if(r!==t.globalImageIdSpecificToolStateManager){r.restoreToolState(e.elementToolState[n]);var i=e.elementViewport[n];o.setViewport(a,i),o.updateImage(a)}}})),e}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";function n(){var e={};return{get:function(o,t){if(!1!==e.hasOwnProperty(o)){var n=e[o];if(!1!==n.hasOwnProperty(t))return n[t]}},add:function(o,t,n){!1===e.hasOwnProperty(o)&&(e[o]={});var a=e[o];!1===a.hasOwnProperty(t)&&(a[t]={data:[]}),a[t].data.push(n)},remove:function(o,t,n){if(!1!==e.hasOwnProperty(o)){var a=e[o];if(!1!==a.hasOwnProperty(t)){for(var r=a[t],i=-1,s=0;s<r.data.length;s++)r.data[s]===n&&(i=s);-1!==i&&r.data.splice(i,1)}}}}}var a=n();t.newFrameOfReferenceSpecificToolStateManager=n,t.globalFrameOfReferenceSpecificToolStateManager=a}($,cornerstone,cornerstoneTools),function(e,o){"use strict";function t(){var o={};return{get:function(t,n){var a=e.getEnabledElement(t);if(a.image&&!1!==o.hasOwnProperty(a.image.imageId)){var r=o[a.image.imageId];if(!1!==r.hasOwnProperty(n))return r[n]}},add:function(t,n,a){var r=e.getEnabledElement(t);r.image&&!1!==o.hasOwnProperty(r.image.imageId)||(o[r.image.imageId]={});var i=o[r.image.imageId];!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(a)},clear:function(t){var n=e.getEnabledElement(t);n.image&&!1!==o.hasOwnProperty(n.image.imageId)&&delete o[n.image.imageId]},saveImageIdToolState:function(e){return o[e]},restoreImageIdToolState:function(e,t){o[e]=t},saveToolState:function(){return o},restoreToolState:function(e){o=e},toolState:o}}var n=t();o.newImageIdSpecificToolStateManager=t,o.globalImageIdSpecificToolStateManager=n}(cornerstone,cornerstoneTools),function(e){"use strict";var o,t,n;e.loadHandlerManager={setStartLoadHandler:function(e){o=e},getStartLoadHandler:function(){return o},setEndLoadHandler:function(e){t=e},getEndLoadHandler:function(){return t},setErrorLoadingHandler:function(e){n=e},getErrorLoadingHandler:function(){return n}}}(cornerstoneTools),function(e,o){"use strict";var t=[];o.newStackSpecificToolStateManager=function(e,o){var t={};return{get:function(n,a){return e.indexOf(a)>=0?(!1===t.hasOwnProperty(a)&&(t[a]={data:[]}),t[a]):o.get(n,a)},add:function(n,a,r){if(!(e.indexOf(a)>=0))return o.add(n,a,r);!1===t.hasOwnProperty(a)&&(t[a]={data:[]}),t[a].data.push(r)},saveToolState:function(){return t},restoreToolState:function(e){t=e},toolState:t}},o.addStackStateManager=function(e){var n=o.getElementToolStateManager(e);n||(n=o.globalImageIdSpecificToolStateManager);var a=o.newStackSpecificToolStateManager(["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs"],n);t.push(a),o.setElementToolStateManager(e,a)}}(cornerstone,cornerstoneTools),function(e){"use strict";var o,t,n;e.textStyle=(t=(o=15)+"px Arial",n="transparent",{setFont:function(e){t=e},getFont:function(){return t},setFontSize:function(e){o=e},getFontSize:function(){return o},setBackgroundColor:function(e){n=e},getBackgroundColor:function(){return n}})}(cornerstoneTools),function(e,o){"use strict";var t=[];o.newTimeSeriesSpecificToolStateManager=function(e,o){var t={};return{get:function(n,a){return e.indexOf(a)>=0?(!1===t.hasOwnProperty(a)&&(t[a]={data:[]}),t[a]):o.get(n,a)},add:function(n,a,r){if(!(e.indexOf(a)>=0))return o.add(n,a,r);!1===t.hasOwnProperty(a)&&(t[a]={data:[]}),t[a].data.push(r)}}},o.addTimeSeriesStateManager=function(e,n){n=n||["timeSeries"];var a=o.getElementToolStateManager(e);void 0===a&&(a=o.globalImageIdSpecificToolStateManager);var r=o.newTimeSeriesSpecificToolStateManager(n,a);t.push(r),o.setElementToolStateManager(e,r)}}(cornerstone,cornerstoneTools),function(e){"use strict";var o,t,n;e.toolColors=(o="white",t="greenyellow",n="transparent",{setFillColor:function(e){n=e},getFillColor:function(){return n},setToolColor:function(e){o=e},getToolColor:function(){return o},setActiveColor:function(e){t=e},getActiveColor:function(){return t},getColorIfActive:function(e){return e?t:o}})}(cornerstoneTools),function(e){"use strict";var o;e.toolCoordinates=(o="",{setCoords:function(e){o=e.currentPoints.canvas},getCoords:function(){return o}})}(cornerstoneTools),function(e,o){"use strict";function t(t){var n=e.getEnabledElement(t);return void 0===n.toolStateManager&&(n.toolStateManager=o.globalImageIdSpecificToolStateManager),n.toolStateManager}o.addToolState=function(e,o,n){t(e).add(e,o,n);var a={toolType:o,element:e,measurementData:n};$(e).trigger("CornerstoneToolsMeasurementAdded",a)},o.getToolState=function(e,o){return t(e).get(e,o)},o.removeToolState=function(e,o,n){for(var a=t(e).get(e,o),r=-1,i=0;i<a.data.length;i++)a.data[i]===n&&(r=i);if(-1!==r){a.data.splice(r,1);var s={toolType:o,element:e,measurementData:n};$(e).trigger("CornerstoneToolsMeasurementRemoved",s)}},o.clearToolState=function(e,o){var n=t(e).get(e,o);void 0!==n&&(n.data=[])},o.setElementToolStateManager=function(o,t){e.getEnabledElement(o).toolStateManager=t},o.getElementToolStateManager=t}(cornerstone,cornerstoneTools),function(e){"use strict";var o,t;e.toolStyle=(o=1,t=2,{setToolWidth:function(e){o=e},getToolWidth:function(){return o},setActiveWidth:function(e){t=e},getActiveWidth:function(){return t}})}(cornerstoneTools),function(e,o,t){"use strict";t.panZoomSynchronizer=function(e,t,n){if(n!==t){var a=o.getViewport(t),r=o.getViewport(n);r.scale===a.scale&&r.translation.x===a.translation.x&&r.translation.y===a.translation.y||(r.scale=a.scale,r.translation.x=a.translation.x,r.translation.y=a.translation.y,e.setViewport(n,r))}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.stackImageIndexSynchronizer=function(e,n,a){if(a!==n){var r=t.getToolState(n,"stack").data[0],i=t.getToolState(a,"stack").data[0],s=r.currentImageIdIndex;if((s=Math.min(Math.max(s,0),i.imageIds.length-1))!==i.currentImageIdIndex){var l=t.loadHandlerManager.getStartLoadHandler(),c=t.loadHandlerManager.getEndLoadHandler(),u=t.loadHandlerManager.getErrorLoadingHandler();l&&l(a),(!0===i.preventCache?o.loadImage(i.imageIds[s]):o.loadAndCacheImage(i.imageIds[s])).then((function(t){var n=o.getViewport(a);i.currentImageIdIndex=s,e.displayImage(a,t,n),c&&c(a)}),(function(e){var o=i.imageIds[s];u&&u(a,o,e)}))}}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.stackImagePositionOffsetSynchronizer=function(e,n,a,r,i){if(a!==n){var s=o.getEnabledElement(n),l=t.metaData.get("imagePlane",s.image.imageId).imagePositionPatient,c=t.getToolState(a,"stack").data[0],u=Number.MAX_VALUE,d=-1;if(i){var g=l.clone().add(i);if(c.imageIds.forEach((function(e,o){var n=t.metaData.get("imagePlane",e).imagePositionPatient,a=g.distanceToSquared(n);a<u&&(u=a,d=o)})),d!==c.currentImageIdIndex&&-1!==d){var f=t.loadHandlerManager.getStartLoadHandler(),m=t.loadHandlerManager.getEndLoadHandler(),h=t.loadHandlerManager.getErrorLoadingHandler();f&&f(a),(!0===c.preventCache?o.loadImage(c.imageIds[d]):o.loadAndCacheImage(c.imageIds[d])).then((function(t){var n=o.getViewport(a);c.currentImageIdIndex=d,e.displayImage(a,t,n),m&&m(a)}),(function(e){var o=c.imageIds[d];h&&h(a,o,e)}))}}}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.stackImagePositionSynchronizer=function(n,a,r){if(r!==a){var i=o.getEnabledElement(a).image,s=t.metaData.get("imagePlane",i.imageId).imagePositionPatient,l=t.getToolState(r,"stack").data[0],c=Number.MAX_VALUE,u=-1;if(e.each(l.imageIds,(function(e,o){var n=t.metaData.get("imagePlane",o).imagePositionPatient.distanceToSquared(s);n<c&&(c=n,u=e)})),u!==l.currentImageIdIndex){var d=t.loadHandlerManager.getStartLoadHandler(),g=t.loadHandlerManager.getEndLoadHandler(),f=t.loadHandlerManager.getErrorLoadingHandler();if(d&&d(r),-1!==u)(!0===l.preventCache?o.loadImage(l.imageIds[u]):o.loadAndCacheImage(l.imageIds[u])).then((function(e){var t=o.getViewport(r);l.currentImageIdIndex=u,n.displayImage(r,e,t),g&&g(r)}),(function(e){var o=l.imageIds[u];f&&f(r,o,e)}))}}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.stackScrollSynchronizer=function(e,n,a,r){if(n!==a&&r&&r.direction){var i=t.getToolState(a,"stack").data[0],s=i.currentImageIdIndex+r.direction;if(s=Math.min(Math.max(s,0),i.imageIds.length-1),i.currentImageIdIndex!==s){var l=t.loadHandlerManager.getStartLoadHandler(),c=t.loadHandlerManager.getEndLoadHandler(),u=t.loadHandlerManager.getErrorLoadingHandler();l&&l(a),(!0===i.preventCache?o.loadImage(i.imageIds[s]):o.loadAndCacheImage(i.imageIds[s])).then((function(t){var n=o.getViewport(a);i.currentImageIdIndex=s,e.displayImage(a,t,n),c&&c(a)}),(function(e){var o=i.imageIds[s];u&&u(a,o,e)}))}}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.Synchronizer=function(n,a){var r=this,i=[],s=[],l=!1,c={},u=a;function d(e,o){i.length&&s.length&&(l=!0,s.forEach((function(t){var n=s.indexOf(t);if(-1!==n){var a=c.imageIds.targetElements[n],l=i.indexOf(e);if(-1!==l){var d,g=c.imageIds.sourceElements[l];d=g===a?0:c.distances[g][a],u(r,e,t,o,d)}}})),l=!1)}function g(e,o){!0!==l&&d(e.currentTarget,o)}function f(e,o){var t=o.element;r.remove(t)}this.setHandler=function(e){u=e},this.getHandler=function(){return u},this.getDistances=function(){i.length&&s.length&&(c.distances={},c.imageIds={sourceElements:[],targetElements:[]},i.forEach((function(e){var n=o.getEnabledElement(e);if(n&&n.image){var a=n.image.imageId,r=t.metaData.get("imagePlane",a);if(r&&r.imagePositionPatient){var i=r.imagePositionPatient;c.hasOwnProperty(n)||(c.distances[a]={},c.imageIds.sourceElements.push(a),s.forEach((function(n){var r=o.getEnabledElement(n);if(r&&r.image){var s=r.image.imageId;if(c.imageIds.targetElements.push(s),e!==n&&a!==s&&!c.distances[a].hasOwnProperty(s)){var l=t.metaData.get("imagePlane",s);if(l&&l.imagePositionPatient){var u=l.imagePositionPatient;c.distances[a][s]=u.clone().sub(i)}}}})),Object.keys(c.distances[a]).length||delete c.distances[a])}}})))},this.addSource=function(o){-1===i.indexOf(o)&&(i.push(o),e(o).on(n,g),r.getDistances(),r.updateDisableHandlers())},this.addTarget=function(e){-1===s.indexOf(e)&&(s.push(e),r.getDistances(),u(r,e,e,0),r.updateDisableHandlers())},this.add=function(e){r.addSource(e),r.addTarget(e)},this.removeSource=function(o){var t=i.indexOf(o);-1!==t&&(i.splice(t,1),e(o).off(n,g),r.getDistances(),d(o),r.updateDisableHandlers())},this.removeTarget=function(e){var o=s.indexOf(e);-1!==o&&(s.splice(o,1),r.getDistances(),u(r,e,e,0),r.updateDisableHandlers())},this.remove=function(e){r.removeTarget(e),r.removeSource(e)},this.getSourceElements=function(){return i},this.getTargetElements=function(){return s},this.displayImage=function(e,t,n){l=!0,o.displayImage(e,t,n),l=!1},this.setViewport=function(e,t){l=!0,o.setViewport(e,t),l=!1},this.updateDisableHandlers=function(){e.unique(i.concat(s)).forEach((function(o){e(o).off("CornerstoneElementDisabled",f),e(o).on("CornerstoneElementDisabled",f)}))},this.destroy=function(){e.unique(i.concat(s)).forEach((function(e){r.remove(e)}))}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.updateImageSynchronizer=function(e,t,n){n!==t&&o.updateImage(n)}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.wwwcSynchronizer=function(e,t,n){if(n!==t){var a=o.getViewport(t),r=o.getViewport(n);r.voi.windowWidth===a.voi.windowWidth&&r.voi.windowCenter===a.voi.windowCenter&&r.invert===a.invert||(r.voi.windowWidth=a.voi.windowWidth,r.voi.windowCenter=a.voi.windowCenter,r.invert=a.invert,e.setViewport(n,r))}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.probeTool4D=t.mouseButtonTool({createNewMeasurement:function(e){var n=t.getToolState(e.element,"timeSeries");if(void 0!==n&&void 0!==n.data&&0!==n.data.length){var a=n.data[0],r={timeSeries:a,lineSample:new t.LineSampleMeasurement,imageIdIndex:a.stacks[a.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};return function(e){var t=[];e.timeSeries.stacks.forEach((function(n){(!0===n.preventCache?o.loadImage(n.imageIds[e.imageIdIndex]):o.loadAndCacheImage(n.imageIds[e.imageIdIndex])).then((function(o){var n=Math.round(e.handles.end.x)+Math.round(e.handles.end.y)*o.width,a=o.getPixelData()[n];t.push(a)}))})),e.lineSample.set(t)}(r),t.MeasurementManager.add(r),r}},onImageRendered:function(e,n){var a=t.getToolState(e.currentTarget,"probe4D");if(void 0!==a){var r=n.canvasContext.canvas.getContext("2d");o.setToPixelCoordinateSystem(n.enabledElement,r);for(var i=0;i<a.data.length;i++){r.save();var s=a.data[i];r.beginPath(),t.drawHandles(r,n,s.handles,"white"),r.stroke();var l=t.setContextToDisplayFontSize(n.enabledElement,n.canvasContext,15);r.font=l.fontSize+"px Arial";var c=Math.round(s.handles.end.x),u=Math.round(s.handles.end.y),d=s.handles.end.x+3,g=s.handles.end.y-3;r.fillStyle="white",r.fillText(c+","+u,d,g),r.restore()}}},toolType:"probe4D"})}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.incrementTimePoint=function(e,n,a){var r=t.getToolState(e,"timeSeries");if(void 0!==r&&void 0!==r.data&&0!==r.data.length){var i=r.data[0],s=i.stacks[i.currentStackIndex].currentImageIdIndex,l=i.currentStackIndex+n;if(a?(l>=i.stacks.length&&(l=0),l<0&&(l=i.stacks.length-1)):(l=Math.min(i.stacks.length-1,l),l=Math.max(0,l)),l!==i.currentStackIndex){var c=o.getViewport(e),u=i.stacks[l],d=t.loadHandlerManager.getStartLoadHandler(),g=t.loadHandlerManager.getEndLoadHandler(),f=t.loadHandlerManager.getErrorLoadingHandler();d&&d(e),(!0===u.preventCache?o.loadImage(u.imageIds[s]):o.loadAndCacheImage(u.imageIds[s])).then((function(t){i.currentImageIdIndex!==s&&(u.currentImageIdIndex=s,i.currentStackIndex=l,o.displayImage(e,t,c),g&&g(e))}),(function(o){var t=u.imageIds[s];f&&f(e,t,o)}))}}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";var n="timeSeriesPlayer";t.timeSeriesPlayer={start:function(e,o){if(void 0===e)throw"playClip: element must not be undefined";void 0===o&&(o=30);var a=t.getToolState(e,"timeSeries");if(void 0!==a&&void 0!==a.data&&0!==a.data.length){var r,i=t.getToolState(e,n);void 0===i||0===i.data.length?(r={intervalId:void 0,framesPerSecond:o,lastFrameTimeStamp:void 0,frameRate:0},t.addToolState(e,n,r)):(r=i.data[0]).framesPerSecond=o,void 0===r.intervalId&&(r.intervalId=setInterval((function(){r.framesPerSecond>0?t.incrementTimePoint(e,1,!0):t.incrementTimePoint(e,-1,!0)}),1e3/Math.abs(r.framesPerSecond)))}},stop:function(e){var o,a=t.getToolState(e,n);void 0!==a&&0!==a.data.length&&(o=a.data[0],clearInterval(o.intervalId),o.intervalId=void 0)}}}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";function n(o,t){e(t.element).off("CornerstoneToolsMouseDrag",a),e(t.element).off("CornerstoneToolsMouseUp",n),e(t.element).off("CornerstoneToolsMouseClick",n)}function a(o,n){o.data.deltaY+=n.deltaPoints.page.y;var a=t.getToolState(n.element,"timeSeries");if(void 0!==a&&void 0!==a.data&&0!==a.data.length){var r=a.data[0],i=e(n.element).height()/r.stacks.length;if(void 0!==o.data.options&&void 0!==o.data.options.timeSeriesScrollSpeed&&(i=o.data.options.timeSeriesScrollSpeed),o.data.deltaY>=i||o.data.deltaY<=-i){var s=Math.round(o.data.deltaY/i),l=o.data.deltaY%i;t.incrementTimePoint(n.element,s),o.data.deltaY=l}return!1}}t.timeSeriesScroll=t.simpleMouseButtonTool((function(o,r){if(t.isMouseButtonEnabled(r.which,o.data.mouseButtonMask)){var i={deltaY:0,options:o.data.options};return e(r.element).on("CornerstoneToolsMouseDrag",i,a),e(r.element).on("CornerstoneToolsMouseUp",n),e(r.element).on("CornerstoneToolsMouseClick",n),o.stopImmediatePropagation(),!1}})),t.timeSeriesScrollWheel=t.mouseWheelTool((function(e,o){var n=-o.direction;t.incrementTimePoint(o.element,n)})),t.timeSeriesScrollTouchDrag=t.touchDragTool((function(e){var o=e.originalEvent.detail,n={deltaY:0};n.deltaY+=o.deltaPoints.page.y;var a=t.getToolState(o.element,"stack");if(void 0!==a&&void 0!==a.data&&0!==a.data.length){if(n.deltaY>=3||n.deltaY<=-3){var r=n.deltaY/3,i=n.deltaY%3;t.setTimePoint(n.element,r),n.deltaY=i}return!1}}))}($,cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.roundToDecimal=function(e,o){var t=Math.pow(10,o);return Math.round(e*t)/t}}($,cornerstone,cornerstoneTools),function(e){"use strict";function o(e){return parseFloat("."+e)}e.calculateSUV=function(e,t){if(dicomParser&&void 0!==e.data&&"PT"===e.data.string("x00080060")){var n=t*e.slope+e.intercept,a=e.data.floatString("x00101030");if(void 0!==a){var r=e.data.elements.x00540016;if(void 0!==r){r=r.items[0].dataSet;var i=dicomParser.parseTM(r.string("x00181072")),s=r.floatString("x00181074"),l=r.floatString("x00181075"),c=dicomParser.parseTM(e.data.string("x00080031"));if(i&&s&&l&&c){var u=o(c.fractionalSeconds)+c.seconds+60*c.minutes+60*c.hours*60-(o(i.fractionalSeconds)+i.seconds+60*i.minutes+60*i.hours*60);return n*a/(s*Math.exp(-u*Math.log(2)/l))*1e3}}}}}}(cornerstoneTools),function(e,o,t,n){"use strict";n.copyPoints=function(e){return{page:t.point.copy(e.page),image:t.point.copy(e.image),client:t.point.copy(e.client),canvas:t.point.copy(e.canvas)}}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e){"use strict";e.drawArrow=function(e,o,t,n,a){var r=Math.atan2(t.y-o.y,t.x-o.x);e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(t.x,t.y),e.strokeStyle=n,e.lineWidth=a,e.stroke(),e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(t.x-10*Math.cos(r-Math.PI/7),t.y-10*Math.sin(r-Math.PI/7)),e.lineTo(t.x-10*Math.cos(r+Math.PI/7),t.y-10*Math.sin(r+Math.PI/7)),e.lineTo(t.x,t.y),e.lineTo(t.x-10*Math.cos(r-Math.PI/7),t.y-10*Math.sin(r-Math.PI/7)),e.strokeStyle=n,e.lineWidth=a,e.stroke(),e.fillStyle=n,e.fill()}}(cornerstoneTools),function(e){"use strict";e.drawEllipse=function(e,o,t,n,a){var r=n/2*.5522848,i=a/2*.5522848,s=o+n,l=t+a,c=o+n/2,u=t+a/2;e.beginPath(),e.moveTo(o,u),e.bezierCurveTo(o,u-i,c-r,t,c,t),e.bezierCurveTo(c+r,t,s,u-i,s,u),e.bezierCurveTo(s,u+i,c+r,l,c,l),e.bezierCurveTo(c-r,l,o,u+i,o,u),e.closePath(),e.stroke()}}(cornerstoneTools),function(e){"use strict";e.drawTextBox=function(o,t,n,a,r,i){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var s=e.textStyle.getFont(),l=e.textStyle.getFontSize(),c=e.textStyle.getBackgroundColor();o.save(),o.font=s,o.textBaseline="top",o.strokeStyle=r;var u=0;t.forEach((function(e){var t=o.measureText(e).width;u=Math.max(u,t)})),o.fillStyle=c;var d={width:u+10,height:5+t.length*(l+5)};return i&&i.centering&&!0===i.centering.x&&(n-=d.width/2),i&&i.centering&&!0===i.centering.y&&(a-=d.height/2),d.left=n,d.top=a,i&&!0===i.debug&&(o.fillStyle="#FF0000"),o.fillRect(d.left,d.top,d.width,d.height),t.forEach((function(e,t){o.fillStyle=r,o.fillText(e,n+5,a+5+t*(l+5))})),o.restore(),d}}(cornerstoneTools),function(e,o){"use strict";o.getLuminance=function(o,t,n,a,r){if(!o)throw"getLuminance: parameter element must not be undefined";t=Math.round(t),n=Math.round(n);var i,s,l,c=e.getEnabledElement(o).image,u=[],d=0,g=c.getPixelData();if(c.color)for(s=0;s<r;s++)for(l=0;l<a;l++){var f=g[i=4*((s+n)*c.columns+(l+t))],m=g[i+1],h=g[i+2];u[d++]=.2126*f+.7152*m+.0722*h}else for(s=0;s<r;s++)for(l=0;l<a;l++)i=(s+n)*c.columns+(l+t),u[d++]=g[i]*c.slope+c.intercept;return u}}(cornerstone,cornerstoneTools),function(e,o){"use strict";var t={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};function n(){var e,o=navigator.userAgent,t=o.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(t[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(o)||[])[1]||""):"Chrome"===t[1]&&null!==(e=o.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=o.match(/version\/(\d+)/i))&&t.splice(1,1,e[1]),t.join(" "))}o.getMaxSimultaneousRequests=function(){var e=o.stackPrefetch.getConfiguration();if(e.maxSimultaneousRequests)return e.maxSimultaneousRequests;var a=n().split(" "),r=a[0],i=a[1],s=t[r];return s?s[i]?s[i]:s.default:t.default},o.getBrowserInfo=n,o.isMobileDevice=function(){return!!new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)}}(cornerstone,cornerstoneTools),function(e,o){"use strict";o.getRGBPixels=function(o,t,n,a,r){if(!o)throw"getRGBPixels: parameter element must not be undefined";t=Math.round(t),n=Math.round(n);var i,s,l,c=e.getEnabledElement(o),u=[],d=0,g=c.image.getPixelData();if(c.image.color)for(s=0;s<r;s++)for(l=0;l<a;l++){var f=g[i=4*((s+n)*c.image.columns+(l+t))],m=g[i+1],h=g[i+2],v=g[i+3];u[d++]=f,u[d++]=m,u[d++]=h,u[d++]=v}return u}}(cornerstone,cornerstoneTools),function(e,o){"use strict";o.isMouseButtonEnabled=function(e,o){return 0!=(o&1<<e-1)}}(cornerstone,cornerstoneTools),function(e,o,t){"use strict";t.pauseEvent=function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}}($,cornerstone,cornerstoneTools),function(e,o){"use strict";o.pointInsideBoundingBox=function(o,t){if(o.boundingBox)return e.point.insideRect(t,o.boundingBox)}}(cornerstoneMath,cornerstoneTools),function(e,o,t){"use strict";function n(e,o){var t=o.rowCosines.clone().multiplyScalar(e.x);t.multiplyScalar(o.columnPixelSpacing);var n=o.columnCosines.clone().multiplyScalar(e.y);n.multiplyScalar(o.rowPixelSpacing);var a=t.add(n);return a.add(o.imagePositionPatient),a}t.projectPatientPointToImagePlane=function(e,o){var t=e.clone().sub(o.imagePositionPatient);return{x:o.rowCosines.dot(t)/o.columnPixelSpacing,y:o.columnCosines.dot(t)/o.rowPixelSpacing}},t.imagePointToPatientPoint=n,t.planePlaneIntersection=function(e,o){var t=e.rowCosines.clone().cross(e.columnCosines),a=new cornerstoneMath.Plane;a.setFromNormalAndCoplanarPoint(t,e.imagePositionPatient);var r=o.rowCosines.clone().cross(o.columnCosines),i=new cornerstoneMath.Plane;i.setFromNormalAndCoplanarPoint(r,o.imagePositionPatient);var s=i.clone().intersectPlane(a),l=s.origin,c=s.direction,u=n({x:o.columns,y:o.rows},o),d=o.imagePositionPatient.distanceTo(u),g=new cornerstoneMath.Line3;g.start=l,g.end=l.clone().add(c.multiplyScalar(d));var f=function(e,o){var t=[];return Object.keys(o).forEach((function(n){var a=o[n],r=e.intersectLine(a);r&&t.push(r)})),t}(g,function(e){var o=n({x:0,y:0},e),t=n({x:e.columns,y:0},e),a=n({x:0,y:e.rows},e),r=n({x:e.columns,y:e.rows},e);return{top:new cornerstoneMath.Line3(o,t),left:new cornerstoneMath.Line3(o,a),right:new cornerstoneMath.Line3(t,r),bottom:new cornerstoneMath.Line3(a,r)}}(o));if(2===f.length)return{start:f[0],end:f[1]}}}($,cornerstone,cornerstoneTools),function(e){"use strict";e.requestAnimFrame=function(e){return window.requestAnimationFrame(e)||window.webkitRequestAnimationFrame(e)||window.mozRequestAnimationFrame(e)||window.oRequestAnimationFrame(e)||window.msRequestAnimationFrame(e)||function(e){window.setTimeout(e,1e3/60)}(e)}}(cornerstoneTools),function(e,o){"use strict";o.scroll=function(e,t){var n=o.getToolState(e,"stack");if(void 0!==n&&void 0!==n.data&&0!==n.data.length){var a=n.data[0],r=a.currentImageIdIndex+t;r=Math.min(a.imageIds.length-1,r),r=Math.max(0,r),o.scrollToIndex(e,r)}}}(cornerstone,cornerstoneTools),function(e,o){"use strict";o.scrollToIndex=function(t,n){var a=o.getToolState(t,"stack");if(a&&a.data&&a.data.length){var r=a.data[0];n<0&&(n+=r.imageIds.length);var i=o.loadHandlerManager.getStartLoadHandler(),s=o.loadHandlerManager.getEndLoadHandler(),l=o.loadHandlerManager.getErrorLoadingHandler(),c=e.getViewport(t);if(n!==r.currentImageIdIndex){i&&i(t);var u={newImageIdIndex:n,direction:n-r.currentImageIdIndex};r.currentImageIdIndex=n;var d=r.imageIds[n],g=o.stackScroll.getConfiguration();if(g&&!0===g.retryLoadOnScroll){var f=e.imageCache.getImagePromise(d);f&&"rejected"===f.state()&&e.imageCache.removeImagePromise(d)}var m=o.requestPoolManager;m.clearRequestStack("interaction");var h=!!r.preventCache;m.addRequest(t,d,"interaction",h,(function(o){r.currentImageIdIndex===n&&(e.displayImage(t,o,c),s&&s(t))}),(function(e){var o=r.imageIds[n];l&&l(t,o,e)})),m.startGrabbing(),$(t).trigger("CornerstoneStackScroll",u)}}},o.loadHandlers={}}(cornerstone,cornerstoneTools),function(e,o){"use strict";o.setContextToDisplayFontSize=function(o,t,n){return e.setToPixelCoordinateSystem(o,t,.1),{fontSize:n/o.viewport.scale/.1,lineHeight:n/o.viewport.scale/.1,fontScale:.1}}}(cornerstone,cornerstoneTools);