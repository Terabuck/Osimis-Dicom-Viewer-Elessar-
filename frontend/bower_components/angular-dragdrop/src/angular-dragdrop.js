!function(e,a,t,n){"use strict";var i=a.module("ngDragDrop",[]).service("ngDragDropService",["$timeout","$parse","$q",function(n,r,l){this.draggableScope=null,this.droppableScope=null,t("head").prepend('<style type="text/css">@charset "UTF-8";.angular-dragdrop-hide{display: none !important;}</style>'),this.callEventCallback=function(e,a,n,i){if(a){var l=function(a){var n=-1!==a.indexOf("(")?a.indexOf("("):a.length,i=-1!==a.lastIndexOf(")")?a.lastIndexOf(")"):a.length,l=a.substring(n+1,i),o=-1!==a.indexOf(".")?a.substr(0,a.indexOf(".")):null;return o=e[o]&&"function"==typeof e[o].constructor?o:null,{callback:a.substring(o&&o.length+1||0,n),args:t.map(l&&l.split(",")||[],(function(a){return[r(a)(e)]})),constructor:o}}(a),o=l.callback,d=l.constructor,s=[n,i].concat(l.args);return(e[o]||e[d][o]).apply(e[o]?e:e[d],s)}},this.invokeDrop=function(e,r,o,d){var s,p,c,u,g,f,b={},h={},v={},y={},x=null,m=this.droppableScope,D=this.draggableScope,q=null,j=[];s=e.ngattr("ng-model"),p=r.ngattr("ng-model"),u=D.$eval(s),g=m.$eval(p),x=r.find("[jqyoui-draggable]:last,[data-jqyoui-draggable]:last"),h=m.$eval(r.attr("jqyoui-droppable")||r.attr("data-jqyoui-droppable"))||[],(b=D.$eval(e.attr("jqyoui-draggable")||e.attr("data-jqyoui-draggable"))||[]).index=this.fixIndex(D,b,u),h.index=this.fixIndex(m,h,g),c=a.isArray(u)?b.index:null,v=a.isArray(u)?u[c]:u,b.deepCopy&&(v=a.copy(v)),y=a.isArray(g)&&h&&void 0!==h.index?g[h.index]:a.isArray(g)?{}:g,h.deepCopy&&(y=a.copy(y)),b.beforeDrop&&j.push(this.callEventCallback(D,b.beforeDrop,o,d)),l.all(j).then(a.bind(this,(function(){if(b.insertInline&&s===p){if(b.index>h.index){f=u[b.index];for(var l=b.index;l>h.index;l--)g[l]=a.copy(g[l-1]),g[l-1]={},g[l][b.direction]="left";g[h.index]=f}else{f=u[b.index];for(l=b.index;l<h.index;l++)g[l]=a.copy(g[l+1]),g[l+1]={},g[l][b.direction]="right";g[h.index]=f}this.callEventCallback(m,h.onDrop,o,d)}else!0===b.animate?((q=e.clone()).css({position:"absolute"}).css(e.offset()),t("body").append(q),e.addClass("angular-dragdrop-hide"),this.move(q,x.length>0?x:r,null,"fast",h,(function(){q.remove()})),this.move(x.length>0&&!h.multiple?x:[],e.parent("[jqyoui-droppable],[data-jqyoui-droppable]"),i.startXY,"fast",h,a.bind(this,(function(){n(a.bind(this,(function(){e.css({position:"relative",left:"",top:""}).removeClass("angular-dragdrop-hide"),x.css({position:"relative",left:"",top:"",display:"none"===x.css("display")?"":x.css("display")}),this.mutateDraggable(D,h,b,s,p,y,e),this.mutateDroppable(m,h,b,p,v,c),this.callEventCallback(m,h.onDrop,o,d)})))})))):n(a.bind(this,(function(){this.mutateDraggable(D,h,b,s,p,y,e),this.mutateDroppable(m,h,b,p,v,c),this.callEventCallback(m,h.onDrop,o,d)})))}))).finally(a.bind(this,(function(){this.restore(e)})))},this.move=function(a,t,n,i,r,l){if(0===a.length)return l&&e.setTimeout((function(){l()}),300),!1;var o=a.css("z-index"),d=a[r.containment||"offset"](),s=t.css("display"),p=t.hasClass("ng-hide"),c=t.hasClass("angular-dragdrop-hide");null===n&&t.length>0&&(void 0!==(t.attr("jqyoui-draggable")||t.attr("data-jqyoui-draggable"))&&void 0!==t.ngattr("ng-model")&&t.is(":visible")&&r&&r.multiple?(n=t[r.containment||"offset"](),!1===r.stack?n.left+=t.outerWidth(!0):n.top+=t.outerHeight(!0)):(p&&t.removeClass("ng-hide"),c&&t.removeClass("angular-dragdrop-hide"),n=t.css({visibility:"hidden",display:"block"})[r.containment||"offset"](),t.css({visibility:"",display:s}))),a.css({position:"absolute","z-index":9999}).css(d).animate(n,i,(function(){p&&t.addClass("ng-hide"),c&&t.addClass("angular-dragdrop-hide"),a.css("z-index",o),l&&l()}))},this.mutateDroppable=function(e,t,n,i,l,o){var d=e.$eval(i);e.dndDragItem=l,a.isArray(d)?(t&&t.index>=0?d[t.index]=l:d.push(l),n&&!0===n.placeholder&&(d[d.length-1].jqyoui_pos=o)):(r(i+" = dndDragItem")(e),n&&!0===n.placeholder&&(d.jqyoui_pos=o))},this.mutateDraggable=function(e,t,n,i,l,o,d){var s=a.equals(o,{})||!o,p=e.$eval(i);e.dndDropItem=o,n&&n.placeholder?"keep"!=n.placeholder&&(a.isArray(p)&&void 0!==n.index?p[n.index]=o:r(i+" = dndDropItem")(e)):a.isArray(p)?s?n&&!0!==n.placeholder&&"keep"!==n.placeholder&&p.splice(n.index,1):p[n.index]=o:(r(i+" = dndDropItem")(e),e.$parent&&r(i+" = dndDropItem")(e.$parent)),this.restore(d)},this.restore=function(e){e.css({"z-index":"",left:"",top:""})},this.fixIndex=function(e,t,n){if(t.applyFilter&&a.isArray(n)&&n.length>0){var i=e[t.applyFilter]()[t.index],r=void 0;return n.forEach((function(e,t){a.equals(e,i)&&(r=t)})),r}return t.index}}]).directive("jqyouiDraggable",["ngDragDropService",function(e){return{require:"?jqyouiDroppable",restrict:"A",link:function(n,r,l){var o,d,s,p,c=t(r),u=function(r,u){r?(o=n.$eval(c.attr("jqyoui-draggable")||c.attr("data-jqyoui-draggable"))||{},d=n.$eval(l.jqyouiOptions)||{},c.draggable({disabled:!1}).draggable(d).draggable({start:function(a,r){e.draggableScope=n,s=t(d.helper?r.helper:this).css("z-index"),t(d.helper?r.helper:this).css("z-index",9999),i.startXY=t(this)[o.containment||"offset"](),e.callEventCallback(n,o.onStart,a,r)},stop:function(a,i){t(d.helper?i.helper:this).css("z-index",s),e.callEventCallback(n,o.onStop,a,i)},drag:function(a,t){e.callEventCallback(n,o.onDrag,a,t)}})):c.draggable({disabled:!0}),p&&a.isDefined(r)&&(a.equals(l.drag,"true")||a.equals(l.drag,"false"))&&(p(),p=null)};p=n.$watch((function(){return n.$eval(l.drag)}),u),u(),c.on("$destroy",(function(){c.draggable({disabled:!0}).draggable("destroy")}))}}}]).directive("jqyouiDroppable",["ngDragDropService","$q",function(e,n){return{restrict:"A",priority:1,link:function(i,r,l){var o,d,s,p=t(r),c=function(r,c){r?(o=i.$eval(t(p).attr("jqyoui-droppable")||t(p).attr("data-jqyoui-droppable"))||{},d=i.$eval(l.jqyouiOptions)||{},p.droppable({disabled:!1}).droppable(d).droppable({over:function(a,t){e.callEventCallback(i,o.onOver,a,t)},out:function(a,t){e.callEventCallback(i,o.onOut,a,t)},drop:function(r,s){var p,c=null;o.beforeDrop?c=e.callEventCallback(i,o.beforeDrop,r,s):((p=n.defer()).resolve(),c=p.promise),c.then(a.bind(this,(function(){t(s.draggable).ngattr("ng-model")&&l.ngModel?(e.droppableScope=i,e.invokeDrop(t(s.draggable),t(this),r,s)):e.callEventCallback(i,o.onDrop,r,s)})),(function(){s.draggable.animate({left:"",top:""},d.revertDuration||0)}))}})):p.droppable({disabled:!0}),s&&a.isDefined(r)&&(a.equals(l.drop,"true")||a.equals(l.drop,"false"))&&(s(),s=null)};s=i.$watch((function(){return i.$eval(l.drop)}),c),c(),p.on("$destroy",(function(){p.droppable({disabled:!0}).droppable("destroy")}))}}}]);t.fn.ngattr=function(e,a){var t=this[0];return t.getAttribute(e)||t.getAttribute("data-"+e)}}(window,window.angular,window.jQuery);